
TestRun "[ts-tacitus] run tests: orta.vscode-jest:TestProvider:ts-tacitus:181 (0)" started
yarn run v1.22.21
$ jest --runInBand --testLocationInResults --json --useStderr --outputFile /var/folders/z3/5d423z657d7fm572qd818jd00000gn/T/jest_runner_ts_tacitus_501_2.json --no-coverage --reporters default --reporters /Users/johnhardy/.cursor/extensions/orta.vscode-jest-6.4.4/out/reporter.js --colors --watchAll=false --testPathPattern /Users/johnhardy/Documents/projects/ts-tacitus/src/test
 FAIL  src/test/ops/lists/structure/reverse.test.ts
  List reverse operation
    ✕ reverse empty list returns empty list (11 ms)
    ✕ reverse single element list returns same list (66 ms)
    ✓ reverse two element list (88 ms)
    ✓ reverse three element list (159 ms)
    ✓ reverse longer list (15 ms)
    ✕ reverse twice returns original list (9 ms)
    ✓ reverse with non-list value returns NIL (8 ms)
    ✕ reverse with nested lists (16 ms)

  ● List reverse operation › reverse empty list returns empty list

    expect(received).toEqual(expected) // deep equality

    - Expected  - 1
    + Received  + 0

      Array [
        NaN,
    -   NaN,
      ]

      21 |
      22 |     const original = executeTacitCode(vm, '( )');
    > 23 |     expect(stack).toEqual(original);
         |                   ^
      24 |   });
      25 |
      26 |   test('reverse single element list returns same list', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/reverse.test.ts:23:19)

  ● List reverse operation › reverse single element list returns same list

    expect(received).toEqual(expected) // deep equality

    - Expected  - 2
    + Received  + 0

      Array [
        42,
        NaN,
    -   42,
    -   NaN,
      ]

      29 |
      30 |     const expected = executeTacitCode(vm, '( 42 )');
    > 31 |     expect(stack).toEqual(expected);
         |                   ^
      32 |   });
      33 |
      34 |   test('reverse two element list', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/reverse.test.ts:31:19)

  ● List reverse operation › reverse twice returns original list

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 4

      Array [
        3,
        2,
        1,
        NaN,
    +   3,
    +   2,
    +   1,
    +   NaN,
      ]

      64 |     const reversed = executeTacitCode(vm, '( 1 2 3 ) reverse reverse');
      65 |
    > 66 |     expect(reversed).toEqual(original);
         |                      ^
      67 |   });
      68 |
      69 |   test('reverse with non-list value returns NIL', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/reverse.test.ts:66:22)

  ● List reverse operation › reverse with nested lists

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 5

    @@ -7,6 +7,11 @@
        3,
        2,
        1,
        NaN,
        NaN,
    +   3,
    +   2,
    +   1,
    +   NaN,
    +   NaN,
      ]

      81 |     const original = executeTacitCode(vm, '( ( 1 2 ) 3 )');
      82 |     const doubleReversed = executeTacitCode(vm, '( ( 1 2 ) 3 ) reverse reverse');
    > 83 |     expect(doubleReversed).toEqual(original);
         |                            ^
      84 |   });
      85 | });
      86 |

      at Object.<anonymous> (src/test/ops/lists/structure/reverse.test.ts:83:28)

 FAIL  src/test/integration/advanced-operations.test.ts
  Tacit Advanced Operations
    ✕ word definitions (16 ms)
    ✓ complex conditions (8 ms)
    ✓ nested if expressions (14 ms)

  ● Tacit Advanced Operations › word definitions

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 1

      Array [
    +   9,
        20,
      ]

      14 |     expect(result).toEqual([9]);
      15 |     result = runTacitTest(vm, ': double 2 mul ; : quadruple double double ; 5 quadruple');
    > 16 |     expect(result).toEqual([20]);
         |                    ^
      17 |     result = runTacitTest(vm, ': swap-and-add swap add ; 3 7 swap-and-add');
      18 |     expect(result).toEqual([10]);
      19 |   });

      at Object.<anonymous> (src/test/integration/advanced-operations.test.ts:16:20)

 FAIL  src/test/lang/interpreter.test.ts
  Interpreter
    Basic operations
      ✓ should execute simple addition (20 ms)
      ✓ should handle subtraction (6 ms)
      ✓ should handle multiplication (5 ms)
      ✓ should handle division (4 ms)
    Stack operations
      ✓ should handle dup (5 ms)
      ✓ should handle drop (4 ms)
      ✓ should handle swap (5 ms)
      ✓ should handle complex stack operations (10 ms)
    Control flow
      ✓ should handle empty program (3 ms)
    Error handling
      ✓ should handle invalid opcodes (3 ms)
      ✕ should handle non-Error exceptions (9 ms)
      ✓ should preserve stack state on error (4 ms)
      ✓ should skip definition body during normal execution (8 ms)
    Memory management
      ✓ should preserve memory when flag is set (4 ms)
      ✓ should reset memory when preserve is false (5 ms)
      ✓ should handle multiple preserve states (8 ms)
    Colon definitions
      ✓ should execute simple colon definition (8 ms)
      ✓ should handle multiple colon definitions (12 ms)
      ✓ should allow colon definitions to use other definitions (6 ms)
      ✓ should handle colon definitions with stack manipulation (13 ms)
      ✓ should handle colon definitions with code blocks (12 ms)

  ● Interpreter › Error handling › should handle non-Error exceptions

    expect(received).toThrow(expected)

    Expected substring: "Error executing word (stack: [5,3])"

    Received function did not throw

      86 |         throw 'Raw string error';
      87 |       });
    > 88 |       expect(() => executeTacitCode(vm, '5 3 add')).toThrow('Error executing word (stack: [5,3])');
         |                                                     ^
      89 |       jest.restoreAllMocks();
      90 |     });
      91 |     test('should preserve stack state on error', () => {

      at Object.<anonymous> (src/test/lang/interpreter.test.ts:88:53)

 FAIL  src/test/ops/local-vars/increment-operator.test.ts
  Increment operator +> (locals-only)
    happy path
      ✓ basic increment by 1 (11 ms)
      ✓ multiple increments (1 then 2) (5 ms)
      ✓ negative and float increments (5 ms)
      ✓ larger increments (5 ms)
    error cases
      ✓ using +> outside a function should throw (17 ms)
      ✓ undefined local variable name should throw (5 ms)
    equivalence with sugar (value x add -> x)
      ✓ 1 +> x equals 1 x add -> x (7 ms)
    bracket path increments
      ✕ parity with desugared form on bracket path (9 ms)

  ● Increment operator +> (locals-only) › bracket path increments › parity with desugared form on bracket path

    expect(received).toEqual(expected) // deep equality

    - Expected  - 3
    + Received  + 0

      Array [
        20,
        17,
        NaN,
    -   20,
    -   17,
    -   NaN,
      ]

      158 |       );
      159 |
    > 160 |       expect(sugar).toEqual(desugared);
          |                     ^
      161 |     });
      162 |   });
      163 | });

      at Object.<anonymous> (src/test/ops/local-vars/increment-operator.test.ts:160:21)

 PASS  src/test/lang/state.test.ts
  parser state helpers
    ✓ setParserState controls getParserState (20 ms)
    ✓ requireParserState returns active state (12 ms)
    ✓ requireParserState throws when state missing (12 ms)

 FAIL  src/test/lang/when-do-control-flow.test.ts
  when/do control flow
    ✓ executes first matching clause and skips default (8 ms)
    ✓ falls through to default when no predicates match (4 ms)
    ✕ supports multiple clauses with shared exit (10 ms)
    ✕ allows nested when blocks inside the default region (6 ms)
    ✓ raises when do appears without a surrounding when (8 ms)
    ✓ raises when when is not closed by final semicolon (4 ms)

  ● when/do control flow › supports multiple clauses with shared exit

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 1

      Array [
    +   111,
        222,
      ]

      55 |
      56 |     const lessThanThree = executeTacitCode(vm, `2 ${program}`);
    > 57 |     expect(lessThanThree).toEqual([222]);
         |                           ^
      58 |
      59 |     const otherwise = executeTacitCode(vm, `5 ${program}`);
      60 |     expect(otherwise).toEqual([333]);

      at Object.<anonymous> (src/test/lang/when-do-control-flow.test.ts:57:27)

  ● when/do control flow › allows nested when blocks inside the default region

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 1

      Array [
    +   200,
        300,
      ]

      73 |
      74 |     const nestedDefault = executeTacitCode(vm, `2 ${program}`);
    > 75 |     expect(nestedDefault).toEqual([300]);
         |                           ^
      76 |   });
      77 |
      78 |   test('raises when do appears without a surrounding when', () => {

      at Object.<anonymous> (src/test/lang/when-do-control-flow.test.ts:75:27)

 FAIL  src/test/lang/case-control-flow.test.ts
  case control flow
    ✓ executes matching clause and consumes the discriminant (7 ms)
    ✓ falls back to default when no predicates match (3 ms)
    ✕ supports multiple clauses with shared exit and default (5 ms)
    ✕ allows nested case constructs inside clause bodies (6 ms)
    ✓ first DEFAULT wins when multiple defaults are present (3 ms)
    ✓ raises when of appears without a surrounding case (10 ms)
    ✓ detects unclosed case constructs during final validation (4 ms)

  ● case control flow › supports multiple clauses with shared exit and default

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 1

      Array [
    +   111,
        222,
      ]

      54 |
      55 |     const zero = executeTacitCode(vm, `0 ${program}`);
    > 56 |     expect(zero).toEqual([222]);
         |                  ^
      57 |
      58 |     const other = executeTacitCode(vm, `5 ${program}`);
      59 |     expect(other).toEqual([333]);

      at Object.<anonymous> (src/test/lang/case-control-flow.test.ts:56:18)

  ● case control flow › allows nested case constructs inside clause bodies

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 1

      Array [
    +   999,
        200,
      ]

      77 |
      78 |     const nestedDefault = executeTacitCode(vm, `5 ${program}`);
    > 79 |     expect(nestedDefault).toEqual([200]);
         |                           ^
      80 |   });
      81 |
      82 |   test('first DEFAULT wins when multiple defaults are present', () => {

      at Object.<anonymous> (src/test/lang/case-control-flow.test.ts:79:27)

 FAIL  src/test/integration/basic-operations.test.ts
  Tacit Basic Operations
    ✕ arithmetic operations (8 ms)
    ✕ stack operations (4 ms)
    ✕ comparison operations (3 ms)
    ✕ if operator (new immediate syntax) (4 ms)
    ✓ bare string shorthand with apostrophe (3 ms)
    ✓ should execute if with true condition (3 ms)
    ✓ should execute if with false condition (2 ms)
    ✓ should execute if/else with true condition (2 ms)
    ✓ should execute if/else with false condition (5 ms)

  ● Tacit Basic Operations › arithmetic operations

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 1

      Array [
    +   8,
        7,
      ]

      14 |     expect(result).toEqual([8]);
      15 |     result = runTacitTest(vm, '10 3 sub');
    > 16 |     expect(result).toEqual([7]);
         |                    ^
      17 |     result = runTacitTest(vm, '5 3 mul');
      18 |     expect(result).toEqual([15]);
      19 |     result = runTacitTest(vm, '15 3 div');

      at Object.<anonymous> (src/test/integration/basic-operations.test.ts:16:20)

  ● Tacit Basic Operations › stack operations

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 2

      Array [
        5,
    +   5,
    +   5,
      ]

      24 |     expect(result).toEqual([5, 5]);
      25 |     result = runTacitTest(vm, '5 3 drop');
    > 26 |     expect(result).toEqual([5]);
         |                    ^
      27 |     result = runTacitTest(vm, '5 3 swap');
      28 |     expect(result).toEqual([3, 5]);
      29 |   });

      at Object.<anonymous> (src/test/integration/basic-operations.test.ts:26:20)

  ● Tacit Basic Operations › comparison operations

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 1

      Array [
    +   1,
        0,
      ]

      32 |     expect(result).toEqual([1]);
      33 |     result = runTacitTest(vm, '5 10 gt');
    > 34 |     expect(result).toEqual([0]);
         |                    ^
      35 |     result = runTacitTest(vm, '5 5 eq');
      36 |     expect(result).toEqual([1]);
      37 |     result = runTacitTest(vm, '5 6 eq');

      at Object.<anonymous> (src/test/integration/basic-operations.test.ts:34:20)

  ● Tacit Basic Operations › if operator (new immediate syntax)

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 1

      Array [
    +   10,
        20,
      ]

      42 |     expect(result).toEqual([10]);
      43 |     result = runTacitTest(vm, '0 if 10 else 20 ;');
    > 44 |     expect(result).toEqual([20]);
         |                    ^
      45 |   });
      46 |   test('bare string shorthand with apostrophe', () => {
      47 |     const result = runTacitTest(vm, "'testWord");

      at Object.<anonymous> (src/test/integration/basic-operations.test.ts:44:20)

 FAIL  src/test/ops/lists/list-spec-compliance.test.ts
  Lists.md Specification Compliance
    Section 9: size and counting
      ✓ length returns payload slot count (7 ms)
      ✓ size returns element count via traversal (4 ms)
      ✓ empty list length and size both return 0 (6 ms)
    Section 10: Address queries
      ✓ slot operation returns slot addresses (3 ms)
      ✓ elem operation returns element addresses (3 ms)
      ✓ fetch and store work with addresses (3 ms)
    Section 12: Structural operations
      ✓ head returns first element (4 ms)
      ✓ head returns nested list correctly (3 ms)
      ✓ head returns nil for empty list (3 ms)
      ✓ concat prepends element (simple + list) (3 ms)
      ✓ tail removes first element (5 ms)
      ✓ structural operations are properly registered (4 ms)
    Algebraic laws (Section 20)
      ✓ concat then tail restores original for prepend case (3 ms)
      ✓ pack with 0 count creates empty list (3 ms)
      ✓ unpack pushes list elements to stack (3 ms)
      ✕ pack and unpack are inverses (5 ms)

  ● Lists.md Specification Compliance › Algebraic laws (Section 20) › pack and unpack are inverses

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 3

      Array [
        1,
        2,
        3,
    +   1,
    +   2,
    +   3,
      ]

      135 |       const original = executeTacitCode(vm, '1 2 3');
      136 |       const restored = executeTacitCode(vm, '1 2 3 3 pack unpack');
    > 137 |       expect(restored).toEqual(original);
          |                        ^
      138 |     });
      139 |   });
      140 | });

      at Object.<anonymous> (src/test/ops/lists/list-spec-compliance.test.ts:137:24)

 FAIL  src/test/ops/lists/structure/head-tail-uncons.test.ts
  List structure operations: head/tail
    ✓ head on simple list returns first element (top of stack) (6 ms)
    ✕ tail on simple list drops first element (5 ms)
    ✕ head on nested list returns the nested list value (suffix match) (4 ms)
    ✕ tail on nested list preserves nested structure (4 ms)
    ✕ tail on empty list returns empty list (3 ms)
    ✕ tail on non-list returns empty list (3 ms)
    ✓ head on non-list returns NIL (3 ms)
    ✓ head on &local (RSTACK list) returns first element (simple) (4 ms)
    ✓ head on &local with nested first element returns nested list (6 ms)
    ✓ tail on &local drops first element and preserves rest (3 ms)
    ✓ reverse on &local reverses logical elements (4 ms)

  ● List structure operations: head/tail › tail on simple list drops first element

    expect(received).toEqual(expected) // deep equality

    - Expected  - 3
    + Received  + 0

      Array [
        3,
        2,
        NaN,
    -   3,
    -   2,
    -   NaN,
      ]

      20 |     const result = executeTacitCode(vm, '( 1 2 3 ) tail');
      21 |     const expected = executeTacitCode(vm, '( 2 3 )');
    > 22 |     expect(result).toEqual(expected);
         |                    ^
      23 |   });
      24 |
      25 |   test('head on nested list returns the nested list value (suffix match)', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/head-tail-uncons.test.ts:22:20)

  ● List structure operations: head/tail › head on nested list returns the nested list value (suffix match)

    expect(received).toEqual(expected) // deep equality

    - Expected  - 3
    + Received  + 0

      Array [
        3,
        2,
        1,
        NaN,
    -   2,
    -   1,
    -   NaN,
      ]

      26 |     const result = executeTacitCode(vm, '( ( 1 2 ) 3 ) head');
      27 |     const expected = executeTacitCode(vm, '( 1 2 )');
    > 28 |     expect(result.slice(-expected.length)).toEqual(expected);
         |                                            ^
      29 |   });
      30 |
      31 |   test('tail on nested list preserves nested structure', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/head-tail-uncons.test.ts:28:44)

  ● List structure operations: head/tail › tail on nested list preserves nested structure

    expect(received).toEqual(expected) // deep equality

    - Expected  - 3
    + Received  + 0

      Array [
        4,
        3,
        NaN,
    -   4,
    -   3,
    -   NaN,
      ]

      32 |     const result = executeTacitCode(vm, '( ( 1 2 ) 3 4 ) tail');
      33 |     const expected = executeTacitCode(vm, '( 3 4 )');
    > 34 |     expect(result).toEqual(expected);
         |                    ^
      35 |   });
      36 |
      37 |   test('tail on empty list returns empty list', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/head-tail-uncons.test.ts:34:20)

  ● List structure operations: head/tail › tail on empty list returns empty list

    expect(received).toEqual(expected) // deep equality

    - Expected  - 1
    + Received  + 0

      Array [
        NaN,
    -   NaN,
      ]

      38 |     const result = executeTacitCode(vm, '( ) tail');
      39 |     const expected = executeTacitCode(vm, '( )');
    > 40 |     expect(result).toEqual(expected);
         |                    ^
      41 |   });
      42 |
      43 |   test('tail on non-list returns empty list', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/head-tail-uncons.test.ts:40:20)

  ● List structure operations: head/tail › tail on non-list returns empty list

    expect(received).toEqual(expected) // deep equality

    - Expected  - 1
    + Received  + 0

      Array [
        NaN,
    -   NaN,
      ]

      44 |     const result = executeTacitCode(vm, '42 tail');
      45 |     const expected = executeTacitCode(vm, '( )');
    > 46 |     expect(result).toEqual(expected);
         |                    ^
      47 |   });
      48 |
      49 |   test('head on non-list returns NIL', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/head-tail-uncons.test.ts:46:20)

 FAIL  src/test/ops/lists/structure/concat-polymorphic.test.ts
  Polymorphic concat Operation
    Type dispatch verification
      ✕ simple + simple should create 2-element list (8 ms)
      ✕ list + simple should append (O1 efficient) (3 ms)
      ✕ simple + list should prepend (3 ms)
      ✕ list + list should concatenate (4 ms)
    Edge cases
      ✕ empty list + simple should work (3 ms)
      ✕ simple + empty list should work (3 ms)
      ✕ empty + empty should work (3 ms)
    Comparison with existing operations
      ✕ simple+simple should match manual list creation (3 ms)
      ✕ list+simple should be equivalent to existing append-like behavior (3 ms)
      ✕ simple+list should match prepend behavior (4 ms)

  ● Polymorphic concat Operation › Type dispatch verification › simple + simple should create 2-element list

    expect(received).toEqual(expected) // deep equality

    - Expected  - 3
    + Received  + 0

      Array [
        3,
        5,
        NaN,
    -   3,
    -   5,
    -   NaN,
      ]

      17 |       const result = executeTacitCode(vm, '5 3 concat');
      18 |       const expected = executeTacitCode(vm, '( 5 3 )');
    > 19 |       expect(result).toEqual(expected);
         |                      ^
      20 |     });
      21 |
      22 |     test('list + simple should append (O1 efficient)', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-polymorphic.test.ts:19:22)

  ● Polymorphic concat Operation › Type dispatch verification › list + simple should append (O1 efficient)

    expect(received).toEqual(expected) // deep equality

    - Expected  - 4
    + Received  + 0

      Array [
        3,
        2,
        1,
        NaN,
    -   3,
    -   2,
    -   1,
    -   NaN,
      ]

      23 |       const result = executeTacitCode(vm, '( 1 2 ) 3 concat');
      24 |       const expected = executeTacitCode(vm, '( 1 2 3 )');
    > 25 |       expect(result).toEqual(expected);
         |                      ^
      26 |     });
      27 |
      28 |     test('simple + list should prepend', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-polymorphic.test.ts:25:22)

  ● Polymorphic concat Operation › Type dispatch verification › simple + list should prepend

    expect(received).toEqual(expected) // deep equality

    - Expected  - 4
    + Received  + 0

      Array [
        2,
        1,
        5,
        NaN,
    -   2,
    -   1,
    -   5,
    -   NaN,
      ]

      29 |       const result = executeTacitCode(vm, '5 ( 1 2 ) concat');
      30 |       const expected = executeTacitCode(vm, '( 5 1 2 )');
    > 31 |       expect(result).toEqual(expected);
         |                      ^
      32 |     });
      33 |
      34 |     test('list + list should concatenate', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-polymorphic.test.ts:31:22)

  ● Polymorphic concat Operation › Type dispatch verification › list + list should concatenate

    expect(received).toEqual(expected) // deep equality

    - Expected  - 5
    + Received  + 0

    @@ -2,11 +2,6 @@
        4,
        3,
        2,
        1,
        NaN,
    -   4,
    -   3,
    -   2,
    -   1,
    -   NaN,
      ]

      35 |       const result = executeTacitCode(vm, '( 1 2 ) ( 3 4 ) concat');
      36 |       const expected = executeTacitCode(vm, '( 1 2 3 4 )');
    > 37 |       expect(result).toEqual(expected);
         |                      ^
      38 |     });
      39 |   });
      40 |

      at Object.<anonymous> (src/test/ops/lists/structure/concat-polymorphic.test.ts:37:22)

  ● Polymorphic concat Operation › Edge cases › empty list + simple should work

    expect(received).toEqual(expected) // deep equality

    - Expected  - 2
    + Received  + 0

      Array [
        5,
        NaN,
    -   5,
    -   NaN,
      ]

      43 |       const result = executeTacitCode(vm, '( ) 5 concat');
      44 |       const expected = executeTacitCode(vm, '( 5 )');
    > 45 |       expect(result).toEqual(expected);
         |                      ^
      46 |     });
      47 |
      48 |     test('simple + empty list should work', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-polymorphic.test.ts:45:22)

  ● Polymorphic concat Operation › Edge cases › simple + empty list should work

    expect(received).toEqual(expected) // deep equality

    - Expected  - 2
    + Received  + 0

      Array [
        5,
        NaN,
    -   5,
    -   NaN,
      ]

      49 |       const result = executeTacitCode(vm, '5 ( ) concat');
      50 |       const expected = executeTacitCode(vm, '( 5 )');
    > 51 |       expect(result).toEqual(expected);
         |                      ^
      52 |     });
      53 |
      54 |     test('empty + empty should work', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-polymorphic.test.ts:51:22)

  ● Polymorphic concat Operation › Edge cases › empty + empty should work

    expect(received).toEqual(expected) // deep equality

    - Expected  - 1
    + Received  + 0

      Array [
        NaN,
    -   NaN,
      ]

      55 |       const result = executeTacitCode(vm, '( ) ( ) concat');
      56 |       const expected = executeTacitCode(vm, '( )');
    > 57 |       expect(result).toEqual(expected);
         |                      ^
      58 |     });
      59 |   });
      60 |

      at Object.<anonymous> (src/test/ops/lists/structure/concat-polymorphic.test.ts:57:22)

  ● Polymorphic concat Operation › Comparison with existing operations › simple+simple should match manual list creation

    expect(received).toEqual(expected) // deep equality

    - Expected  - 3
    + Received  + 0

      Array [
        8,
        7,
        NaN,
    -   8,
    -   7,
    -   NaN,
      ]

      63 |       const ccatResult = executeTacitCode(vm, '7 8 concat');
      64 |       const manualResult = executeTacitCode(vm, '( 7 8 )');
    > 65 |       expect(ccatResult).toEqual(manualResult);
         |                          ^
      66 |     });
      67 |
      68 |     test('list+simple should be equivalent to existing append-like behavior', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-polymorphic.test.ts:65:26)

  ● Polymorphic concat Operation › Comparison with existing operations › list+simple should be equivalent to existing append-like behavior

    expect(received).toEqual(expected) // deep equality

    - Expected  - 4
    + Received  + 0

      Array [
        30,
        20,
        10,
        NaN,
    -   30,
    -   20,
    -   10,
    -   NaN,
      ]

      70 |       const ccatResult = executeTacitCode(vm, '( 10 20 ) 30 concat');
      71 |       const expectedResult = executeTacitCode(vm, '( 10 20 30 )');
    > 72 |       expect(ccatResult).toEqual(expectedResult);
         |                          ^
      73 |     });
      74 |
      75 |     test('simple+list should match prepend behavior', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-polymorphic.test.ts:72:26)

  ● Polymorphic concat Operation › Comparison with existing operations › simple+list should match prepend behavior

    expect(received).toEqual(expected) // deep equality

    - Expected  - 5
    + Received  + 0

    @@ -2,11 +2,6 @@
        3,
        2,
        1,
        99,
        NaN,
    -   3,
    -   2,
    -   1,
    -   99,
    -   NaN,
      ]

      76 |       const ccatResult = executeTacitCode(vm, '99 ( 1 2 3 ) concat');
      77 |       const expected = executeTacitCode(vm, '( 99 1 2 3 )');
    > 78 |       expect(ccatResult).toEqual(expected);
         |                          ^
      79 |     });
      80 |   });
      81 | });

      at Object.<anonymous> (src/test/ops/lists/structure/concat-polymorphic.test.ts:78:26)

 FAIL  src/test/ops/local-vars/compound-var.test.ts
  Compound Variables - Empty Lists
    ✕ should store empty list in local variable and return reference (8 ms)
    ✓ should work with length operation polymorphically (4 ms)
    ✕ should match direct empty list length (5 ms)
    ✕ should materialize actual list with load (4 ms)
  Compound Variables - Single Element Lists
    ✕ should store single-element list in local variable and return value (5 ms)
    ✓ should work with length operation on single-element list (3 ms)
    ✕ should match direct single-element list length (5 ms)
    ✓ should materialize triple-element list with load (5 ms)
    ✓ should work with head operation on single-element list (4 ms)

  ● Compound Variables - Empty Lists › should store empty list in local variable and return reference

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 2
    Received array:  [NaN, NaN]

      40 |     `,
      41 |     );
    > 42 |     expect(materializedResult).toHaveLength(1);
         |                                ^
      43 |     // Both should work with length operation but reference doesn't need resolve
      44 |     const refLength = executeTacitCode(
      45 |       vm,

      at Object.<anonymous> (src/test/ops/local-vars/compound-var.test.ts:42:32)

  ● Compound Variables - Empty Lists › should match direct empty list length

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 1

      Array [
        0,
    +   0,
      ]

      83 |     );
      84 |
    > 85 |     expect(varLength).toEqual(directLength);
         |                       ^
      86 |     expect(varLength).toEqual([0]);
      87 |   });
      88 |

      at Object.<anonymous> (src/test/ops/local-vars/compound-var.test.ts:85:23)

  ● Compound Variables - Empty Lists › should materialize actual list with load

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 2
    Received array:  [NaN, NaN]

      101 |     );
      102 |
    > 103 |     expect(resolveEmpty).toHaveLength(1);
          |                          ^
      104 |     expect(directEmpty).toHaveLength(1);
      105 |     // Test that both behave the same with length operation
      106 |     const directLength = executeTacitCode(vm, '() length');

      at Object.<anonymous> (src/test/ops/local-vars/compound-var.test.ts:103:26)

  ● Compound Variables - Single Element Lists › should store single-element list in local variable and return value

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 3
    Received array:  [1, NaN, NaN]

      154 |     `,
      155 |     );
    > 156 |     expect(refResult).toHaveLength(1); // Should be DATA_REF resolving to return stack
          |                       ^
      157 |   });
      158 |
      159 |   test('should work with length operation on single-element list', () => {

      at Object.<anonymous> (src/test/ops/local-vars/compound-var.test.ts:156:23)

  ● Compound Variables - Single Element Lists › should match direct single-element list length

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 1

      Array [
        1,
    +   1,
      ]

      185 |     );
      186 |
    > 187 |     expect(varLength).toEqual(directLength);
          |                       ^
      188 |     expect(varLength).toEqual([1]);
      189 |   });
      190 |

      at Object.<anonymous> (src/test/ops/local-vars/compound-var.test.ts:187:23)

 FAIL  src/test/lang/immediate-words.test.ts
  Immediate words
    ✓ executes builtin opcode immediates immediately (5 ms)
    ✓ executes immediate colon definitions via code references (4 ms)
    ✓ colon definition words execute immediately (4 ms)
    ✕ if immediate compiles single-branch conditionals (5 ms)
    ✕ if/else immediate compiles dual-branch conditionals (4 ms)
    ✓ else without if raises syntax error (8 ms)

  ● Immediate words › if immediate compiles single-branch conditionals

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 1

      Array [
    +   5,
        4,
      ]

      56 |
      57 |     const negateFalse = executeTacitCode(vm, ': maybe-negate dup 0 lt if neg ; ; 4 maybe-negate');
    > 58 |     expect(negateFalse).toEqual([4]);
         |                         ^
      59 |   });
      60 |
      61 |   test('if/else immediate compiles dual-branch conditionals', () => {

      at Object.<anonymous> (src/test/lang/immediate-words.test.ts:58:25)

  ● Immediate words › if/else immediate compiles dual-branch conditionals

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 1

      Array [
    +   1,
        -1,
      ]

      65 |
      66 |     const negative = executeTacitCode(vm, '-7 0 lt if -1 else 1 ;');
    > 67 |     expect(negative).toEqual([-1]);
         |                      ^
      68 |   });
      69 |
      70 |   test('else without if raises syntax error', () => {

      at Object.<anonymous> (src/test/lang/immediate-words.test.ts:67:22)

 FAIL  src/test/ops/lists/structure/concat-basic.test.ts
  Concat operation scenarios
    ✕ simple + simple -> ( 1 2 ) (8 ms)
    ✕ simple + list (prepend) -> ( 1 2 3 ) (3 ms)
    ✕ list + simple (append) -> ( 1 2 3 ) (3 ms)
    ✕ list + list (flat) -> ( 1 2 3 4 ) (5 ms)
    ✕ empty + list -> list (4 ms)
    ✕ list + empty -> list (3 ms)
    ✕ empty + empty -> empty (4 ms)
    ✕ nested elements preserved as units (3 ms)

  ● Concat operation scenarios › simple + simple -> ( 1 2 )

    expect(received).toEqual(expected) // deep equality

    - Expected  - 3
    + Received  + 0

      Array [
        2,
        1,
        NaN,
    -   2,
    -   1,
    -   NaN,
      ]

      13 |     const result = executeTacitCode(vm, '1 2 concat');
      14 |     const expected = executeTacitCode(vm, '( 1 2 )');
    > 15 |     expect(result).toEqual(expected);
         |                    ^
      16 |   });
      17 |
      18 |   test('simple + list (prepend) -> ( 1 2 3 )', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-basic.test.ts:15:20)

  ● Concat operation scenarios › simple + list (prepend) -> ( 1 2 3 )

    expect(received).toEqual(expected) // deep equality

    - Expected  - 4
    + Received  + 0

      Array [
        3,
        2,
        1,
        NaN,
    -   3,
    -   2,
    -   1,
    -   NaN,
      ]

      19 |     const result = executeTacitCode(vm, '1 ( 2 3 ) concat');
      20 |     const expected = executeTacitCode(vm, '( 1 2 3 )');
    > 21 |     expect(result).toEqual(expected);
         |                    ^
      22 |   });
      23 |
      24 |   test('list + simple (append) -> ( 1 2 3 )', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-basic.test.ts:21:20)

  ● Concat operation scenarios › list + simple (append) -> ( 1 2 3 )

    expect(received).toEqual(expected) // deep equality

    - Expected  - 4
    + Received  + 0

      Array [
        3,
        2,
        1,
        NaN,
    -   3,
    -   2,
    -   1,
    -   NaN,
      ]

      25 |     const result = executeTacitCode(vm, '( 1 2 ) 3 concat');
      26 |     const expected = executeTacitCode(vm, '( 1 2 3 )');
    > 27 |     expect(result).toEqual(expected);
         |                    ^
      28 |   });
      29 |
      30 |   test('list + list (flat) -> ( 1 2 3 4 )', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-basic.test.ts:27:20)

  ● Concat operation scenarios › list + list (flat) -> ( 1 2 3 4 )

    expect(received).toEqual(expected) // deep equality

    - Expected  - 5
    + Received  + 0

    @@ -2,11 +2,6 @@
        4,
        3,
        2,
        1,
        NaN,
    -   4,
    -   3,
    -   2,
    -   1,
    -   NaN,
      ]

      31 |     const result = executeTacitCode(vm, '( 1 2 ) ( 3 4 ) concat');
      32 |     const expected = executeTacitCode(vm, '( 1 2 3 4 )');
    > 33 |     expect(result).toEqual(expected);
         |                    ^
      34 |   });
      35 |
      36 |   test('empty + list -> list', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-basic.test.ts:33:20)

  ● Concat operation scenarios › empty + list -> list

    expect(received).toEqual(expected) // deep equality

    - Expected  - 3
    + Received  + 0

      Array [
        8,
        7,
        NaN,
    -   8,
    -   7,
    -   NaN,
      ]

      37 |     const result = executeTacitCode(vm, '( ) ( 7 8 ) concat');
      38 |     const expected = executeTacitCode(vm, '( 7 8 )');
    > 39 |     expect(result).toEqual(expected);
         |                    ^
      40 |   });
      41 |
      42 |   test('list + empty -> list', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-basic.test.ts:39:20)

  ● Concat operation scenarios › list + empty -> list

    expect(received).toEqual(expected) // deep equality

    - Expected  - 3
    + Received  + 0

      Array [
        8,
        7,
        NaN,
    -   8,
    -   7,
    -   NaN,
      ]

      43 |     const result = executeTacitCode(vm, '( 7 8 ) ( ) concat');
      44 |     const expected = executeTacitCode(vm, '( 7 8 )');
    > 45 |     expect(result).toEqual(expected);
         |                    ^
      46 |   });
      47 |
      48 |   test('empty + empty -> empty', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-basic.test.ts:45:20)

  ● Concat operation scenarios › empty + empty -> empty

    expect(received).toEqual(expected) // deep equality

    - Expected  - 1
    + Received  + 0

      Array [
        NaN,
    -   NaN,
      ]

      49 |     const result = executeTacitCode(vm, '( ) ( ) concat');
      50 |     const expected = executeTacitCode(vm, '( )');
    > 51 |     expect(result).toEqual(expected);
         |                    ^
      52 |   });
      53 |
      54 |   test('nested elements preserved as units', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-basic.test.ts:51:20)

  ● Concat operation scenarios › nested elements preserved as units

    expect(received).toEqual(expected) // deep equality

    - Expected  - 8
    + Received  + 0

    @@ -5,14 +5,6 @@
        3,
        2,
        1,
        NaN,
        NaN,
    -   5,
    -   NaN,
    -   4,
    -   3,
    -   2,
    -   1,
    -   NaN,
    -   NaN,
      ]

      55 |     const result = executeTacitCode(vm, '( ( 1 2 ) 3 ) ( 4 ( 5 ) ) concat');
      56 |     const expected = executeTacitCode(vm, '( ( 1 2 ) 3 4 ( 5 ) )');
    > 57 |     expect(result).toEqual(expected);
         |                    ^
      58 |   });
      59 | });
      60 |

      at Object.<anonymous> (src/test/ops/lists/structure/concat-basic.test.ts:57:20)

 FAIL  src/test/ops/lists/build/pack-unpack.test.ts
  List build operations: pack/unpack/enlist
    ✓ pack builds list from n items (behavioral) (7 ms)
    ✓ unpack pushes list elements (4 ms)
    ✕ enlist converts value to single-element list (5 ms)
    ✕ pack with zero count yields empty list (3 ms)

  ● List build operations: pack/unpack/enlist › enlist converts value to single-element list

    expect(received).toEqual(expected) // deep equality

    - Expected  - 2
    + Received  + 0

      Array [
        42,
        NaN,
    -   42,
    -   NaN,
      ]

      24 |     const stack = executeTacitCode(vm, '42 enlist');
      25 |     const expected = executeTacitCode(vm, '( 42 )');
    > 26 |     expect(stack).toEqual(expected);
         |                   ^
      27 |   });
      28 |
      29 |   test('pack with zero count yields empty list', () => {

      at Object.<anonymous> (src/test/ops/lists/build/pack-unpack.test.ts:26:19)

  ● List build operations: pack/unpack/enlist › pack with zero count yields empty list

    expect(received).toEqual(expected) // deep equality

    - Expected  - 1
    + Received  + 0

      Array [
        NaN,
    -   NaN,
      ]

      30 |     const stack = executeTacitCode(vm, '0 pack');
      31 |     const expected = executeTacitCode(vm, '( )');
    > 32 |     expect(stack).toEqual(expected);
         |                   ^
      33 |   });
      34 | });
      35 |

      at Object.<anonymous> (src/test/ops/lists/build/pack-unpack.test.ts:32:19)

 FAIL  src/test/ops/broadcast/negate-broadcast.test.ts
  Unary broadcasting: neg
    ✓ simple value (8 ms)
    ✓ flat list (4 ms)
    ✕ nested list (pretty-printed assertions) (9 ms)
    ✓ empty list (3 ms)

  ● Unary broadcasting: neg › nested list (pretty-printed assertions)

    expect(received).toEqual(expected) // deep equality

    - Expected  -  0
    + Received  + 15

      Array [
    +   3,
    +   2,
    +   1,
    +   NaN,
    +   NaN,
    +   -3,
    +   -2,
    +   -1,
    +   NaN,
    +   NaN,
    +   -3,
    +   -2,
    +   -1,
    +   NaN,
    +   NaN,
        2,
      ]

      39 |     // Element count preserved
      40 |     const lengths = runTacitTest(vm, '( ( 1 2 ) 3 ) neg size');
    > 41 |     expect(lengths).toEqual([2]);
         |                     ^
      42 |   });
      43 |
      44 |   test('empty list', () => {

      at Object.<anonymous> (src/test/ops/broadcast/negate-broadcast.test.ts:41:21)

 FAIL  src/test/ops/lists/build/open-close-parser-integration.test.ts
  List parser integration: open/close
    ✓ basic roundtrip ( ) parses to LIST header and payload (behavioral) (6 ms)
    ✕ nested lists parse correctly (6 ms)

  ● List parser integration: open/close › nested lists parse correctly

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 6

    @@ -3,6 +3,12 @@
        3,
        2,
        NaN,
        1,
        NaN,
    +   4,
    +   3,
    +   2,
    +   NaN,
    +   1,
    +   NaN,
      ]

      22 |     // Roundtrip property: reversing twice preserves
      23 |     const doubleReverse = executeTacitCode(vm, '( 1 ( 2 3 ) 4 ) reverse reverse');
    > 24 |     expect(doubleReverse).toEqual(stack);
         |                           ^
      25 |   });
      26 | });
      27 |

      at Object.<anonymous> (src/test/ops/lists/build/open-close-parser-integration.test.ts:24:27)

 PASS  src/test/core/vm-comprehensive-testing.test.ts
  VM Comprehensive Testing - Step 12
    Performance Testing
      ✓ should have no performance regression for built-in operations (28 ms)
      ✓ should handle rapid symbol resolution without memory leaks (653 ms)
    Memory Usage Patterns
      ✓ should demonstrate function table can be eliminated for colon definitions (3 ms)
      ✓ should handle symbol table growth efficiently (64 ms)
      ✓ should maintain memory efficiency with mixed symbol types (11 ms)
    Edge Cases and Error Conditions
      ✓ should handle invalid symbol references gracefully (9 ms)
      ✓ should handle stack underflow during symbol execution (9 ms)
      ✓ should handle complex execution chains without corruption (4 ms)
      ✓ should handle symbol resolution with corrupted internal state (3 ms)
    Stress Testing
      ✓ should handle large numbers of sequential symbol references (1444 ms)
      ✓ should handle nested symbol execution patterns (45 ms)
    Integration Workflow Testing
      ✓ should handle complete @symbol eval workflow with mixed types (3 ms)
      ✓ should handle rapid symbol type switching (14 ms)
      ✓ should integrate properly with existing VM operations (4 ms)
      ✓ should maintain stack integrity across complex operations (4 ms)
    System State Validation
      ✓ should maintain consistent VM state across all operations (4 ms)
      ✓ should handle error recovery gracefully (3 ms)

 PASS  src/test/core/vm-symbol-resolution.test.ts
  VM Symbol Resolution
    resolveSymbol method
      ✓ should return undefined for non-existent symbols (5 ms)
      ✓ should resolve built-in symbols to Tag.BUILTIN tagged values (3 ms)
      ✓ should resolve code symbols to Tag.CODE tagged values (4 ms)
      ✓ should resolve multiple different symbol types (3 ms)
      ✓ should handle symbol shadowing correctly (3 ms)
      ✓ resolved values should be executable by VM (4 ms)
      ✓ should maintain consistency with code-ref utilities (3 ms)
    integration with symbol table
      ✓ should work with symbol table checkpoint and revert (3 ms)
      ✓ should resolve symbols defined with unified define method (3 ms)
    error handling
      ✓ should handle empty symbol names gracefully (3 ms)
      ✓ should handle whitespace symbol names gracefully (3 ms)
      ✓ should handle symbols with unusual characters (5 ms)

 PASS  src/test/lang/file-processor.test.ts
  processFile
    ✓ should add .tacit extension when missing (5 ms)
    ✓ should not add .tacit extension when already present (3 ms)
    ✓ should return false when file does not exist (3 ms)
    ✓ should process file content line by line (6 ms)
    ✓ should return false on execution error (3 ms)
    ✓ should return false on file read error (3 ms)
  processFiles
    ✓ should initialize interpreter once and process all files successfully (3 ms)
    ✓ should exit on first file error when exitOnError is true (3 ms)
    ✓ should not exit on file error when exitOnError is false (3 ms)

 PASS  src/test/ops/interpreter/interpreter-operations.test.ts
  Built-in Words
    Control Flow Operations
      ✓ abortOp should stop execution (4 ms)
      ✓ exitOp should restore IP from return stack and BP frame (3 ms)
      ✓ evalOp should push IP to return stack, set up BP frame, and jump (3 ms)
      ✓ branchOp should jump relative (3 ms)
      ✓ callOp should jump to absolute address and set up BP frame (3 ms)
    evalOp with Tag.BUILTIN
      ✓ should execute built-in add operation via Tag.BUILTIN (3 ms)
      ✓ should execute built-in dup operation via Tag.BUILTIN (3 ms)
      ✓ should execute built-in multiply operation via Tag.BUILTIN (3 ms)
      ✓ should handle non-executable values by pushing back on stack (3 ms)
    Literal Operations
      ✓ literalNumberOp should push numbers (3 ms)
      ✓ should handle tagged pointers (4 ms)
    Grouping Operations
      ✓ groupLeftOp should push the current SP (cells) onto the return stack (3 ms)
      ✓ groupRightOp should compute the number of stack cells pushed since group left (3 ms)
    Error Handling
      ✓ should show stack state in errors (3 ms)
      ✓ should handle underflow for swap (6 ms)
      ✓ should handle underflow for dup (3 ms)
      ✓ should handle return stack overflow (6 ms)

 PASS  src/test/lang/parser-symbol.test.ts
  @symbol Parser/Compiler Integration - Step 14
    Basic @symbol syntax
      ✓ should parse and execute @add (6 ms)
      ✓ should parse and execute @dup (4 ms)
      ✓ should parse and execute @swap (4 ms)
      ✓ should work with English abbreviations (3 ms)
    @symbol with colon definitions
      ✓ should work with simple colon definition (4 ms)
      ✓ should work with complex colon definition (6 ms)
      ✓ should work with multiple colon definitions (5 ms)
    @symbol without eval (tagged values on stack)
      ✓ should push Tag.BUILTIN for built-ins (4 ms)
      ✓ should push Tag.CODE for colon definitions (3 ms)
    @symbol metaprogramming scenarios
      ✓ should store and use symbol references (4 ms)
      ✓ should work with conditional execution (4 ms)
      ✓ should work with list of operations (3 ms)
    @symbol error handling
      ✓ should throw error for non-existent symbol (8 ms)
      ✓ should throw error for malformed @symbol syntax (6 ms)
    @symbol mixed with regular operations
      ✓ should work alongside regular operations (3 ms)
      ✓ should work in word definitions (3 ms)
      ✓ should work with multiple @symbols in one expression (6 ms)
    @symbol edge cases
      ✓ should handle @symbols with underscores and hyphens (4 ms)
      ✓ should handle @symbols with numbers (4 ms)
      ✓ should work with nested @symbol calls (4 ms)

 PASS  src/test/core/format-utils.coverage.test.ts
  format-utils additional coverage
    ✓ formats near-integer floats by rounding (5 ms)
    ✓ formats tiny floats with fixed then trim (2 ms)
    ✓ formats LIST via reference from memory (3 ms)
    ✓ formats atomic via reference from memory (non-list) (3 ms)
    ✓ formats strings with carriage return escape (3 ms)
    ✓ formatList returns empty list when SP insufficient (3 ms)
    ✓ formatValue handles empty LIST header on stack (formatListFromStack early return) (3 ms)
    ✓ formatValue handles empty LIST via memory reference (formatListFromMemory early return) (2 ms)
    ✓ formatValue handles nested LIST from stack (formatListFromStack recursion branch) (2 ms)

 PASS  src/test/ops/lists/integration/stack-interactions.test.ts
  List Operations
    list operations
      ✓ should duplicate simple value under a list (7 ms)
      ✓ should duplicate list under simple value (4 ms)
      ✓ should remove list under another list (4 ms)
      ✓ should handle multi-element lists (3 ms)
      ✓ should swap two simple lists (3 ms)
      ✓ should rotate a list with two simple values (3 ms)
      ✓ should pick a list from the stack (3 ms)
    integration tests
      ✓ should duplicate a nested list (3 ms)
      ✓ should handle nested lists correctly during operations (3 ms)
      ✓ should drop a nested list completely (3 ms)
      ✓ should handle complex list interactions (3 ms)
    elem operation tests
      ✓ should access element from simple list (3 ms)
      ✓ should access element 0 from simple list (3 ms)
      ✓ should handle nested list access - reproduce select-ops issue (4 ms)
      ✓ should test direct double elem access as user suggested (3 ms)
      ✓ should test the exact select-ops case: 1 elem then 0 elem (4 ms)
      ✓ should show step by step what happens (5 ms)
      ✓ sizeOp verification - next op to fix (3 ms)

 PASS  src/test/ops/arithmetic/arithmetic.test.ts
  Arithmetic Operations
    simple values
      ✓ should add two positive numbers (5 ms)
      ✓ should add positive and negative numbers (3 ms)
      ✓ should add zero values (3 ms)
      ✓ should subtract two numbers correctly (3 ms)
      ✓ should subtract with negative result (3 ms)
      ✓ should subtract negative operands (3 ms)
      ✓ should multiply two positive numbers (3 ms)
      ✓ should multiply with negative numbers (2 ms)
      ✓ should multiply by zero (3 ms)
      ✓ should divide two numbers correctly (4 ms)
      ✓ should divide with decimal result (3 ms)
      ✓ should divide negative numbers (2 ms)
      ✓ should handle division by zero (3 ms)
      ✓ should calculate power correctly (3 ms)
      ✓ should handle fractional exponents (2 ms)
      ✓ should handle negative base (2 ms)
      ✓ should handle zero base (3 ms)
      ✓ should calculate modulo correctly (3 ms)
      ✓ should handle negative modulo (2 ms)
      ✓ should handle zero modulus (3 ms)
      ✓ should return minimum value (3 ms)
      ✓ should handle negative min values (2 ms)
      ✓ should return maximum value (3 ms)
      ✓ should handle negative max values (3 ms)
      ✓ should return absolute value (2 ms)
      ✓ should return same value for positive absolute (2 ms)
      ✓ should handle zero absolute (3 ms)
      ✓ should negate positive number (3 ms)
      ✓ should negate negative number (2 ms)
      ✓ should handle zero negation (4 ms)
      ✓ should return sign of positive number (3 ms)
      ✓ should return sign of negative number (2 ms)
      ✓ should return sign of zero (3 ms)
      ✓ should calculate square root (3 ms)
      ✓ should handle zero square root (2 ms)
      ✓ should calculate exponential (3 ms)
      ✓ should calculate natural logarithm (2 ms)
      ✓ should calculate log base 10 (2 ms)
    error cases
      ✓ should throw on add stack underflow (9 ms)
      ✓ should throw on subtract stack underflow (3 ms)
      ✓ should throw on multiply stack underflow (2 ms)
      ✓ should throw on divide stack underflow (3 ms)
      ✓ should throw on power stack underflow (3 ms)
      ✓ should throw on modulo stack underflow (3 ms)
      ✓ should throw on min stack underflow (2 ms)
      ✓ should throw on max stack underflow (3 ms)
    integration tests
      ✓ should handle add operation with Tacit syntax (4 ms)
      ✓ should handle sub operation with Tacit syntax (3 ms)
      ✓ should handle mul operation with Tacit syntax (3 ms)
      ✓ should handle div operation with Tacit syntax (3 ms)
      ✓ should handle min operation with Tacit syntax (6 ms)
      ✓ should handle max operation with Tacit syntax (6 ms)
      ✓ should handle pow operation with Tacit syntax (2 ms)
      ✓ should handle eq operation with Tacit syntax (6 ms)
      ✓ should handle lt operation with Tacit syntax (8 ms)
      ✓ should handle le operation with Tacit syntax (8 ms)
      ✓ should handle gt operation with Tacit syntax (9 ms)
      ✓ should handle ge operation with Tacit syntax (9 ms)
      ✓ should handle mod operation with Tacit syntax (5 ms)

 PASS  src/test/core/vm-unified-dispatch.test.ts
  VM Unified Dispatch
    Tag.BUILTIN dispatch via evalOp
      ✓ should execute built-in Add operation directly (5 ms)
      ✓ should execute built-in Dup operation directly (3 ms)
      ✓ should execute built-in Swap operation (3 ms)
      ✓ should execute built-in Drop operation (4 ms)
    non-executable values
      ✓ should push back non-executable values unchanged (11 ms)
    error cases
      ✓ should handle invalid built-in opcodes gracefully (7 ms)
      ✓ should handle stack underflow in built-ins (6 ms)
      ✓ should handle empty stack with evalOp (3 ms)
    performance verification
      ✓ should execute built-ins without call frame overhead (3 ms)
      ✓ should handle complex sequences efficiently (3 ms)

 PASS  src/test/lang/path-brackets.comprehensive.test.ts
  Path bracket syntax: x[ ... ] and value -> x[ ... ]
    ✓ retrieve simple value: x[0 1] => 2 (7 ms)
    ✓ retrieve compound value: x[0 0] is a list (length 2) (4 ms)
    ✓ postfix path on arbitrary expression: (1 2 3)[0] => 1 (3 ms)
    ✓ maplist string keys in bracket: obj['stats 'count] => 2 (6 ms)
    ✓ maplist write via string keys: 7 -> obj['stats 'count] (4 ms)
    ✓ update simple value: 5 -> x[1 1] then x[1 1] == 5 (3 ms)
    ✓ update compound compatible: (1 2 3) -> x[0 0], length becomes 3 (4 ms)
    ✓ update compound incompatible shape throws (4 ms)
    ✓ invalid path in update throws (bad index) (4 ms)
    ✓ deeper nested update: change head of innermost list (4 ms)
    ✓ empty path retrieval yields NIL (3 ms)
    ✓ empty path update throws (no target selected) (3 ms)
    ✓ whitespace inside brackets is tolerated (3 ms)
    ✓ non-numeric, non-string path element errors at parse time (8 ms)
    ✓ negative index retrieval returns NIL (3 ms)
    ✓ negative index update throws (3 ms)
    ✓ multiple updates persist: sequence of writes reflects latest (4 ms)

 PASS  src/test/core/vm-push-symbol-ref.test.ts
  VM pushSymbolRef method
    built-in operations
      ✓ should push built-in add reference and execute correctly (7 ms)
      ✓ should push built-in dup reference and execute correctly (3 ms)
      ✓ should push built-in swap reference and execute correctly (3 ms)
      ✓ should push correct Tag.BUILTIN tagged value (6 ms)
    mixed scenarios
      ✓ should handle both built-ins and colon definitions together (3 ms)
      ✓ should enable chained execution with evalOp (3 ms)
    error cases
      ✓ should throw error for non-existent symbol (7 ms)
      ✓ should throw error for empty symbol name (5 ms)
      ✓ should not affect stack when symbol not found (3 ms)
    workflow simulation
      ✓ should simulate complete @symbol eval workflow (2 ms)

 PASS  src/test/core/tagged-value-roundtrip.test.ts
  dictionary-only builtins
    ✓ convert to tagged value and decode from 0 to 1000 (84 ms)

 PASS  src/test/lang/compiler-coverage.test.ts
  Compiler - Branch Coverage
    compileOpcode error conditions
      ✓ should throw error for negative opcode address (10 ms)
      ✓ should throw error for opcode address >= 32768 (3 ms)
      ✓ should throw error for very large opcode address (3 ms)
      ✓ should handle opcode address at boundary (32767) (2 ms)
    compileOpcode encoding paths
      ✓ should use single-byte encoding for opcodes < MIN_USER_OPCODE (2 ms)
      ✓ should use two-byte encoding for opcodes >= MIN_USER_OPCODE (4 ms)
      ✓ should properly encode large user opcodes (3 ms)
    compileUserWordCall
      ✓ should throw error for negative address (3 ms)
      ✓ should throw error for address >= 32768 (3 ms)
      ✓ should always use two-byte encoding regardless of address (2 ms)
      ✓ should properly encode user word call with MSB set (3 ms)
    patchOpcode error conditions
      ✓ should throw error for negative opcode address in patch (3 ms)
      ✓ should throw error for opcode address >= 32768 in patch (3 ms)
      ✓ should handle single-byte opcode patching (2 ms)
      ✓ should handle two-byte opcode patching (3 ms)
    Compiler reset behavior
      ✓ should save CP to BCP when preserve is true (3 ms)
      ✓ should restore CP from BCP when preserve is false (4 ms)
    Edge cases and boundary conditions
      ✓ should handle zero opcode address (3 ms)
      ✓ should handle MIN_USER_OPCODE boundary (2 ms)
      ✓ should handle maximum valid opcode address (3 ms)
      ✓ should handle patching at various memory locations (2 ms)
    Compiler instance methods
      ✓ should work with new compiler instance (2 ms)
      ✓ should handle compile operations on new instance (3 ms)

 PASS  src/test/ops/stack/drop.test.ts
  drop Operation
    simple values
      ✓ should drop a regular value from the stack (5 ms)
      ✓ should drop the top value leaving others intact (3 ms)
    list operations (LIST semantics)
      ✓ should drop an entire simple list (3 ms)
      ✓ should drop a list while leaving other values on stack (3 ms)
      ✓ should drop multiple lists consecutively (3 ms)
    error cases
      ✓ should throw on empty stack (8 ms)

 PASS  src/test/core/format-utils.test.ts
  Format Utils
    formatAtomicValue
      simple values
        ✓ should format integer numbers (6 ms)
        ✓ should format floating point numbers (3 ms)
        ✓ should format negative numbers (3 ms)
        ✓ should format zero (3 ms)
      string values
        ✓ should format valid strings from digest (3 ms)
        ✓ should handle invalid string addresses (3 ms)
        ✓ should format empty strings (3 ms)
        ✓ should format strings with escape sequences (4 ms)
      other tag types
        ✓ should format CODE tags with tag name and value (3 ms)
        ✓ should format LIST tags with tag name and value (3 ms)
        ✓ should format numeric value (3 ms)
    formatValue
      simple values
        ✓ should format number values (3 ms)
        ✓ should format floating point values (3 ms)
        ✓ should format string values (3 ms)
        ✓ should format invalid string values (3 ms)
      other value types
        ✓ should format CODE values (3 ms)
        ✓ should format unknown tag types (3 ms)
      error cases
        ✓ should handle special float values through formatFloat (7 ms)
        ✓ should handle infinity values (3 ms)
      integration tests
        ✓ should handle mixed data types in complex structures (3 ms)

 PASS  src/test/ops/lists/query/find-default.coverage.test.ts
  findOp default branch coverage
    ✓ find returns default value reference when key not found (7 ms)

 PASS  src/test/lang/parser.test.ts
  Parser with Tokenizer
    Basic parsing
      ✓ should parse numbers correctly (7 ms)
      ✓ should parse built-in words correctly (7 ms)
      ✓ should parse mixed content correctly (5 ms)
      ✓ should handle empty input (5 ms)
    Colon definitions
      ✓ should parse simple word definitions (7 ms)
      ✓ should parse word definitions with numbers in name (6 ms)
      ✓ should parse word definitions with numbers as name (9 ms)
      ✓ should handle empty word definitions (15 ms)
      ✓ should throw an error for unclosed definitions (15 ms)
      ✓ should throw an error for unexpected semicolons (5 ms)
      ✓ should throw an error for nested definitions (4 ms)
    Multiple definitions
      ✓ should handle multiple word definitions (5 ms)
      ✓ should allow words to use previously defined words (4 ms)
    Error handling
      ✓ should throw on malformed word definition (5 ms)
      ✓ should throw on unterminated string (6 ms)
      ✓ should throw on unknown words (6 ms)
    Word definitions
      ✓ should define and find simple words (5 ms)
      ✓ should handle multiple word definitions (6 ms)
      ✓ should handle words with numbers in name (5 ms)
      ✓ should handle words with special characters (5 ms)
    Number parsing
      ✓ should parse positive integers (4 ms)
      ✓ should parse negative numbers (10 ms)
      ✓ should parse floating point numbers (4 ms)
      ✓ should parse multiple numbers (4 ms)
    Comments and whitespace
      ✓ should ignore comments (3 ms)
      ✓ should handle inline comments (4 ms)
      ✓ should handle empty lines (3 ms)
      ✓ should handle extra whitespace (7 ms)
    String handling
      ✓ should parse string literals (5 ms)
      ✓ should handle empty strings (4 ms)
      ✓ should handle escaped characters in strings (4 ms)
      ✓ should handle strings with special characters (4 ms)

 PASS  src/test/ops/lists/list-ops-coverage.test.ts
  List Operations - Branch Coverage
    openListOp functionality
      ✓ should initialize list construction correctly (6 ms)
    closeListOp functionality and edge cases
      ✓ should complete list construction correctly (4 ms)
      ✓ should handle empty lists (no reversal needed) (3 ms)
      ✓ should handle lists with listDepth undefined (backward compatibility) (3 ms)
    sizeOp edge cases
      ✓ should return NIL for non-list values (4 ms)
      ✓ should return 0 for empty lists (4 ms)
      ✓ should count nested lists correctly (4 ms)
    Stack underflow protection
      ✓ sizeOp should handle empty stack (31 ms)
      ✓ closeListOp should handle return stack underflow (5 ms)
    List validation and type checking
      ✓ should handle large list headers (4 ms)
      ✓ should handle mixed data types in operations (4 ms)
    Complex list structures
      ✓ should handle deeply nested list operations (3 ms)
      ✓ should handle large lists efficiently (4 ms)
    Memory and stack management
      ✓ should maintain stack integrity during complex operations (3 ms)

 PASS  src/test/lang/repl.test.ts
  REPL
    ✓ should initialize the interpreter on startup (6 ms)
    ✓ should handle no files case (5 ms)
    ✓ should process files when provided (5 ms)
    ✓ should handle file processing errors (3 ms)
    ✓ should not enter interactive mode when interactiveAfterFiles is false (3 ms)
    ✓ should handle the "exit" command (7 ms)
    ✓ should handle the "load" command (4 ms)
    ✓ should handle errors during "load" command (4 ms)
    ✓ should handle exceptions during "load" command (4 ms)
    ✓ should execute standard commands (4 ms)
    ✓ should handle execution errors (3 ms)
    ✓ should handle non-Error execution errors (3 ms)
    ✓ should handle the "close" event (4 ms)
    ✓ should handle invalid commands in REPL (3 ms)
    ✓ should handle empty input in REPL (3 ms)

 PASS  src/test/lang/executor.test.ts
  Executor
    executeLine
      ✓ should tokenize, parse, and execute the input (5 ms)
      ✓ should propagate errors from tokenizer (4 ms)
      ✓ should propagate errors from parser (4 ms)
      ✓ should propagate errors from execute (4 ms)
      ✓ should handle empty input gracefully (4 ms)

 PASS  src/test/core/reference-formatting.test.ts
  Reference Formatting
    ✓ should format local variable references correctly (12 ms)
    ✓ should format the original f2 case correctly (8 ms)
    ✓ should handle non-list references correctly (7 ms)
    ✓ should print references correctly via print operation (7 ms)

 PASS  src/test/lang/capsules/capsule-constructor.basic.test.ts
  Capsule constructor (language-level) — minimal to locals
    ✓ zero locals: capsule returns return-stack DATA_REF handle; layout LIST:1 (CODE only) (17 ms)
    ✓ two locals: layout LIST:3 (locals 2 + CODE 1) (5 ms)

 PASS  src/test/core/list.coverage.test.ts
  core/list additional coverage
    ✓ reverseSpan early return for spanSize <= 1 (5 ms)
    ✓ reverseSpan reverses last N values in place (3 ms)
    ✓ getListElemAddr returns -1 for negative index (4 ms)
    ✓ getListElemAddr computes correct addresses for flat list (4 ms)
    ✓ getListElemAddr throws for non-list header (10 ms)
    ✓ getListBounds returns null for ref pointing to non-list (5 ms)
    ✓ getListBounds follows ref-to-ref indirection (5 ms)
    ✓ getListElemAddr traverses GLOBAL list via unified read (4 ms)

 PASS  src/test/core/list.test.ts
  LIST Core Utilities
    ✓ should correctly identify LIST types (1 ms)
    ✓ should handle LIST with zero slot count (1 ms)
    ✓ should handle LIST with maximum slot count
    ✓ should validate LIST value ranges (3 ms)
    ✓ should include LIST in encoded/decoded round-trip tests (1 ms)
    createList
      ✓ should create empty LIST (4 ms)
      ✓ should create LIST with single value (3 ms)
      ✓ should create LIST with multiple values in reverse order (4 ms)
      ✓ should handle mixed tag types (3 ms)
    getListSlotCount
      ✓ should extract slot count from LIST header
      ✓ should handle zero slot count (1 ms)
      ✓ should handle maximum slot count
      ✓ should throw on non-LIST header (1 ms)
    dropList
      ✓ should skip empty LIST (3 ms)
      ✓ should skip LIST with single value (3 ms)
      ✓ should skip LIST with multiple values (4 ms)
      ✓ should throw on non-LIST at TOS (4 ms)
    validateListHeader
      ✓ should validate correct LIST header (4 ms)
      ✓ should throw on empty stack (5 ms)
      ✓ should throw on non-LIST at TOS (3 ms)
      ✓ should throw on insufficient payload space (3 ms)
      ✓ should throw on slot count exceeding maximum (3 ms)
    reverseSpan
      ✓ should handle single element (no change) (3 ms)
      ✓ should handle zero elements (no change) (3 ms)
      ✓ should reverse two elements (3 ms)
      ✓ should reverse multiple elements (5 ms)
      ✓ should reverse odd number of elements (4 ms)
      ✓ should throw on insufficient stack (3 ms)
    Integration Tests
      ✓ should create, validate, and skip LIST in sequence (6 ms)
      ✓ should handle nested LIST creation workflow (8 ms)

 PASS  src/test/strings/dictionary-payloads.test.ts
  Dictionary payload types
    Local variables (Tag.LOCAL)
      ✓ defineLocal creates LOCAL entry with slot number (8 ms)
      ✓ multiple locals get sequential slot numbers (5 ms)
      ✓ locals can be looked up by name (4 ms)
    CODE entries (Tag.CODE)
      ✓ defineCode creates CODE entry with bytecode address (3 ms)
      ✓ defineCode with immediate flag sets meta=1 (3 ms)
    DATA_REF entries (Tag.DATA_REF)
      ✓ define with DATA_REF creates entry with DATA_REF payload (3 ms)
      ✓ DATA_REF can reference any data segment cell (3 ms)
      ✓ multiple DATA_REF entries can reference different cells (3 ms)
      ✓ DATA_REF can be looked up and decoded correctly (2 ms)
    CODE_REF entries (Tag.CODE via createCodeRef)
      ✓ define with CODE_REF creates entry with CODE payload (2 ms)
      ✓ CODE_REF can reference different bytecode addresses (5 ms)
      ✓ CODE_REF can be looked up and decoded correctly (3 ms)
      ✓ CODE_REF is equivalent to defineCode result (3 ms)
    Mixed payload types
      ✓ can define BUILTIN, CODE, and LOCAL in same dictionary (3 ms)
      ✓ can define BUILTIN, CODE, LOCAL, and DATA_REF in same dictionary (3 ms)
      ✓ can define BUILTIN, CODE_REF, LOCAL, and DATA_REF in same dictionary (3 ms)
      ✓ lookup finds most recent entry (LIFO order) (3 ms)
    Mark and forget (scope management)
      ✓ mark returns current heap position (3 ms)
      ✓ forget reverts heap and dictionary to mark position (4 ms)
      ✓ forget handles nested scopes correctly (5 ms)
      ✓ forget with empty dictionary sets head to 0 (2 ms)
      ✓ forget updates head correctly (2 ms)
    Local variable slot allocation
      ✓ localCount increments for each local (3 ms)
      ✓ localCount persists after mark (mark only tracks heap position) (3 ms)
      ✓ localCount persists across forget (forget only reverts heap) (2 ms)
    Edge cases
      ✓ lookup returns NIL for non-existent name (2 ms)
      ✓ forget with invalid mark throws error (8 ms)
      ✓ multiple entries with same name - lookup finds most recent (2 ms)

 PASS  src/test/tacit-test-utils.test.ts
  tacitTestUtils
    testTacitCode
      ✓ should validate stack output correctly (6 ms)
      ✓ should throw error for stack length mismatch (8 ms)
      ✓ should throw error for value mismatch (4 ms)
      ✓ should handle floating-point precision (3 ms)
      ✓ should throw error for NaN values (6 ms)
      ✓ should throw error for non-numeric stack values (3 ms)
    executeTacitCode
      ✓ should execute Tacit code and return stack (3 ms)
      ✓ should handle empty code (3 ms)
      ✓ should handle complex stack operations (3 ms)
    captureTacitOutput
      ✓ should capture console output (5 ms)
      ✓ should handle multiple outputs (3 ms)
      ✓ should handle empty output (2 ms)
    runTacitTest
      ✓ should execute Tacit code and return stack state (3 ms)
      ✓ should handle complex stack operations (3 ms)
      ✓ should handle empty input (3 ms)

 PASS  src/test/ops/lists/integration/language-integration.test.ts
  List Integration Tests
    simple values
      ✓ should create and manipulate simple lists with Tacit syntax (LIST) (6 ms)
      ✓ should perform list arithmetic operations (3 ms)
    list operations
      ✓ should handle deeply nested list structures (3 ms)
      ✓ should manipulate mixed data types in lists (3 ms)
      ✓ should handle list composition and decomposition (4 ms)
    error cases
      ✓ should handle empty lists in complex operations (3 ms)
      ✓ should gracefully handle malformed list operations (3 ms)
    integration tests
      ✓ should execute complex list manipulation chains (3 ms)
      ✓ should handle mixed stack operations with lists and values (4 ms)
      ✓ should preserve list integrity through multiple operations (3 ms)
      ✓ should handle extreme nesting scenarios (2 ms)
      ✓ should support list operations in conditional contexts (2 ms)
    parser + VM integration (LIST semantics)
      ✓ should build a simple list using ( ) syntax (3 ms)
      ✓ should build nested lists correctly (2 ms)
      ✓ should lay out nested list stack as: 4 3 2 LIST:2 1 LIST:5 ← TOS (2 ms)
    memory layout validation
      ✓ should keep list payload contiguous in memory (2 ms)

 PASS  src/test/lang/compiler.test.ts
  Compiler
    ✓ should compile a positive integer as a tagged pointer (4 ms)
    ✓ should compile a negative integer as a tagged pointer (3 ms)
    ✓ should compile an address as a tagged pointer (3 ms)
    ✓ should compile a literal number (3 ms)
    ✓ should compile a built-in word (3 ms)
    ✓ should preserve compiled code when preserve is true (3 ms)

 PASS  src/test/lang/parser-redefinition.test.ts
  Forth-style word redefinition (shadowing)
    ✓ redefinition shadows previous and new body can call old one (8 ms)

 PASS  src/test/ops/stack/nip.test.ts
  nip Operation
    simple values
      ✓ should remove second element with simple values (5 ms)
      ✓ should work with multiple simple values on stack (3 ms)
      ✓ should work with negative numbers (3 ms)
      ✓ should work with exactly two elements (3 ms)
    list operations (LIST semantics)
      ✓ should remove simple value under a list (keeping list) (4 ms)
      ✓ should remove list under simple value (keeping simple value) (4 ms)
      ✓ should remove list under another list (3 ms)
      ✓ should handle multi-element lists (3 ms)
      ✓ should handle nested lists correctly (4 ms)
    error cases
      ✓ should throw on stack underflow with empty stack (8 ms)
      ✓ should throw on stack underflow with only one element (3 ms)
      ✓ should throw on stack underflow with only one list (3 ms)

 PASS  src/test/ops/arithmetic/unary-operations.test.ts
  Unary Operations
    simple values
      ✓ should negate a positive number (4 ms)
      ✓ should negate a negative number (5 ms)
      ✓ should negate zero (3 ms)
      ✓ should calculate reciprocal of positive number (3 ms)
      ✓ should calculate reciprocal of negative number (2 ms)
      ✓ should handle reciprocal division by zero (2 ms)
      ✓ should floor positive numbers (3 ms)
      ✓ should floor negative numbers (3 ms)
      ✓ should floor whole numbers unchanged (3 ms)
      ✓ should return 1 for logical not of zero (3 ms)
      ✓ should return 0 for logical not of non-zero values (2 ms)
      ✓ should return 0 for logical not of negative numbers (3 ms)
      ✓ should return 1 for signum of positive numbers (3 ms)
      ✓ should return -1 for signum of negative numbers (3 ms)
      ✓ should return 0 for signum of zero (6 ms)
    error cases
      ✓ should throw on negate stack underflow (9 ms)
      ✓ should throw on reciprocal stack underflow (3 ms)
      ✓ should throw on floor stack underflow (3 ms)
      ✓ should throw on not stack underflow (3 ms)
      ✓ should throw on signum stack underflow (2 ms)
      ✓ should throw on enlist stack underflow (4 ms)

 PASS  src/test/lang/end-to-end-local-vars.test.ts
  End-to-End Local Variables Integration
    Complete function compilation and execution
      ✓ should compile and execute function without variables first (6 ms)
      ✓ should compile and execute function with simple locals (4 ms)
      ✓ should handle multiple functions with different variable counts (5 ms)
      ✓ should handle variable shadowing correctly (3 ms)
      ✓ should handle nested function calls with locals (4 ms)
    Reserve back-patching verification
      ✓ should emit correct Reserve opcode for functions with variables (9 ms)
      ✓ should handle functions without variables (no Reserve) (4 ms)
    Complex variable operations
      ✓ should handle variable reuse and modification (4 ms)
      ✓ should work with floating point variables (4 ms)
      ✓ should handle negative values (4 ms)
    Integration with existing operations
      ✓ should work with stack operations (3 ms)
      ✓ should work with arithmetic operations (4 ms)
      ✓ should work with conditional operations (4 ms)
    Error handling and edge cases
      ✓ should handle zero values (3 ms)
      ✓ should handle large numbers (3 ms)
      ✓ should isolate variables between function calls (3 ms)
    Performance and stress testing
      ✓ should handle many variables efficiently (6 ms)
      ✓ should handle recursive-style operations (5 ms)

 PASS  src/test/core/memory-segdata.test.ts
  SEG_DATA unified access (Phase B)
    ✓ read stack TOS via SEG_DATA (4 ms)
    ✓ read return stack TOS via SEG_DATA (3 ms)

 PASS  src/test/ops/stack/revrot.test.ts
  revrot Operation
    simple values
      ✓ should reverse rotate three simple values (5 ms)
      ✓ should reverse rotate with more values on stack (3 ms)
    list operations
      ✓ should reverse rotate a list with two simple values (3 ms)
      ✓ should handle nested lists (3 ms)
      ✓ should reverse rotate three lists (3 ms)
    error cases
      ✓ should throw on insufficient stack depth (8 ms)
      ✓ should throw on empty stack (3 ms)

 PASS  src/test/lang/local-vars-error-handling.test.ts
  Local Variables Error Handling
    Variable declaration validation
      ✓ should reject variable declarations outside functions (15 ms)
      ✓ should reject invalid variable names (4 ms)
      ✓ should reject var without name (3 ms)
    Variable reference validation
      ✓ should handle undefined variable references gracefully (3 ms)
      ✓ should handle variables that go out of scope (8 ms)
    Memory and stack validation
      ✓ should handle functions with many variables without crashing (9 ms)
      ✓ should handle empty functions with variable declarations (3 ms)
      ✓ should handle functions that declare but never reference variables (3 ms)
    Edge cases and boundary conditions
      ✓ should handle zero values in variables (4 ms)
      ✓ should handle negative values (3 ms)
      ✓ should handle large numbers (3 ms)
      ✓ should handle variable shadowing edge cases (3 ms)
      ✓ should handle rapid variable declaration and access (4 ms)
    Integration error handling
      ✓ should handle variables with arithmetic operations (3 ms)
      ✓ should handle variables with stack operations (4 ms)
      ✓ should handle variables in nested function calls (3 ms)

 PASS  src/test/ops/access/select-op.test.ts
  selectOp - Path-based address access
    ✓ should return NIL for empty path (7 ms)
    ✓ should return NIL for non-list target (3 ms)
    ✓ should handle simple numeric path (list path) (4 ms)
    ✓ should handle simple path as list with fetch (3 ms)
    ✓ should handle simple numeric path (scalar path) (3 ms)
    ✓ should handle two-element numeric path (7 ms)
    ✓ should handle two-step numeric path on ( (10 20) (30 40) ) -> 30 (3 ms)
    ✓ should handle mixed path with number then string (4 ms)
    ✓ should handle selection on data-stack DATA_REF target (4 ms)
    ✓ should handle selection on return-stack DATA_REF target (4 ms)
    ✓ should return default value for missing key when default present (3 ms)
    ✓ should traverse mixed numeric/string path to nested field (4 ms)
    ✓ scalar numeric path returns correct value with fetch (3 ms)
    ✓ out-of-bounds early returns NIL (3 ms)
    createTargetRef function
      ✓ should create stack ref for list target (3 ms)
      ✓ should return false for simple target (3 ms)
    processPathStep function
      ✓ should verify elemOp works with simple list (5 ms)
      ✓ should verify elemOp works with element 0 (3 ms)
      ✓ should process numeric path element (3 ms)
      ✓ should handle two-step path traversal manually (3 ms)
      ✓ should return false for NIL result (3 ms)
    traverseMultiPath function
      ✓ should traverse single element path (3 ms)

 PASS  src/test/lang/case-corruption-branch.test.ts
  case end corruption branch
    ✓ endCaseOp detects return stack mismatch (10 ms)

 PASS  src/test/ops/broadcast/broadcast-helpers.test.ts
  broadcast helpers
    unaryFlat
      ✓ applies function to simple scalar (5 ms)
      ✓ transforms list payload in place (3 ms)
      ✓ returns immediately for empty list (2 ms)
      ✓ throws stack underflow when no operands (7 ms)
    binaryFlat
      ✓ simple × simple delegates to numeric op (5 ms)
      ✓ list × list cycles shorter operand (3 ms)
      ✓ scalar × list applies op across RHS payload (3 ms)
      ✓ scalar × empty list produces empty list (4 ms)
      ✓ list × scalar applies op across LHS payload (3 ms)
      ✓ list × scalar with empty list yields empty list (3 ms)
      ✓ throws stack underflow when operands missing (3 ms)
    unaryRecursive
      ✓ duplicates list and increments every numeric payload cell (3 ms)
      ✓ throws when scalar operand is non-numeric (2 ms)
    binaryRecursive
      ✓ scalar × nested list (scalar on left) recurses (3 ms)
      ✓ raises mismatch when encountering non-number in list payload (3 ms)
      ✓ raises mismatch for simple × simple non-numeric pair (3 ms)

 PASS  src/test/ops/lists/query/length-size.test.ts
  List query operations: length/size
    ✓ length returns slot count for simple list (6 ms)
    ✓ size returns element count for simple list (4 ms)
    ✓ size works on return-stack list reference (&local) (5 ms)
    ✓ size on &local empty list returns 0 (4 ms)
    ✓ length on &local empty list returns 0 (4 ms)
    ✓ length for non-list returns NIL (3 ms)
    ✓ size for non-list returns NIL (2 ms)

 PASS  src/test/ops/comparison/comparison.test.ts
  Comparison Operations
    simple values
      ✓ equal - should return 1 for equal values (4 ms)
      ✓ equal - should return 0 for unequal values (3 ms)
      ✓ equal - should handle negative numbers (5 ms)
      ✓ equal - should handle zero (2 ms)
      ✓ less than - should return 1 when a < b (3 ms)
      ✓ less than - should return 0 when a >= b (3 ms)
      ✓ less than - should handle equal values (3 ms)
      ✓ less than - should handle negative numbers (3 ms)
      ✓ greater than - should return 1 when a > b (3 ms)
      ✓ greater than - should return 0 when a <= b (3 ms)
      ✓ greater than - should handle equal values (3 ms)
      ✓ greater than - should handle negative numbers (5 ms)
      ✓ less than or equal - should return 1 when a <= b (3 ms)
      ✓ less than or equal - should return 1 when a == b (3 ms)
      ✓ less than or equal - should return 0 when a > b (5 ms)
      ✓ greater than or equal - should return 1 when a >= b (3 ms)
      ✓ greater than or equal - should return 1 when a == b (4 ms)
      ✓ greater than or equal - should return 0 when a < b (5 ms)
    error cases
      ✓ equal - should throw on stack underflow (13 ms)
      ✓ less than - should throw on stack underflow (5 ms)
      ✓ greater than - should throw on stack underflow (4 ms)
      ✓ less than or equal - should throw on stack underflow (3 ms)
      ✓ greater than or equal - should throw on stack underflow (3 ms)

 PASS  src/test/lang/parser.comprehensive.test.ts
  Comprehensive Parser Tests
    Error Handling
      ✓ should throw on unclosed definition (18 ms)
      ✓ should throw on nested definitions (7 ms)
      ✓ should throw on definition without name (7 ms)
      ✓ should throw on unexpected closing parenthesis (7 ms)
    Word Definitions
      ✓ should handle empty word definitions (7 ms)
      ✓ should handle words with special characters in name (4 ms)
      ✓ should handle word names that start with numbers (4 ms)
    Lists
      ✓ should parse empty lists (3 ms)
      ✓ should parse lists with elements (4 ms)
    Control Structures
      ✓ should parse IF-ELSE-THEN (4 ms)
    String Literals
      ✓ should parse empty string literals (5 ms)
      ✓ should parse string literals with spaces (3 ms)
    Bare String Shorthand
      ✓ should parse 'key as a string literal (3 ms)

 PASS  src/test/core/vm.test.ts
  VM
    Stack operations
      ✓ should push and pop 20-bit values from the stack (5 ms)
      ✓ should push and pop 32-bit floats from the stack (3 ms)
      ✓ should throw an error on stack overflow (11 ms)
      ✓ should throw an error on stack underflow (4 ms)
      ✓ should return the correct stack data (3 ms)
      ✓ should handle address tagging (3 ms)
    Return stack operations
      ✓ should push and pop 20-bit values from the return stack (7 ms)
      ✓ should throw an error on return stack overflow (3 ms)
      ✓ should throw an error on return stack underflow (12 ms)
      ✓ should handle address tagging on return stack (7 ms)
      ✓ should handle integer tagging on return stack (3 ms)
    Instruction pointer operations
      ✓ should read values from memory using the instruction pointer (2 ms)
      ✓ should increment the instruction pointer after reading (2 ms)
      ✓ should handle nextAddress correctly (3 ms)
    Compiler and dictionary initialization
      ✓ should initialize the compiler with the VM instance (2 ms)
      ✓ should initialize the dictionary with builtins (2 ms)
      ✓ should expose compiled bytes in code segment (3 ms)

 PASS  src/test/ops/conditional/conditionals.test.ts
  Conditional Operations
    simple values
      ✓ if executes then-branch when condition is true (6 ms)
      ✓ if skips then-branch when condition is false (3 ms)
      ✓ if handles empty then-branch (2 ms)
      ✓ if/else executes then-branch when condition is true (3 ms)
      ✓ if/else executes else-branch when condition is false (3 ms)
      ✓ if/else handles empty else-branch (3 ms)
      ✓ if/else works with comparison operators (4 ms)
    integration tests
      ✓ if handles nested conditionals (3 ms)
      ✓ if/else handles complex expressions (4 ms)
      ✓ if/else handles multiple statements in branches (4 ms)
      ✓ if/else works with multiple conditions (3 ms)

 PASS  src/test/lang/case-immediate.test.ts
  case immediates
    ✓ beginCaseImmediate pushes saved RSP and closer (7 ms)
    ✓ clauseOfImmediate emits comparison sequence and records placeholder (3 ms)
    ✓ defaultImmediate compiles sentinel literal (3 ms)
    ✓ nilImmediate compiles NIL sentinel literal (3 ms)
    ✓ ensureNoOpenConditionals flags unclosed case (5 ms)
    ✓ of without case raises error (4 ms)
    ✓ endOfOp patches predicate skip and records exit branch (3 ms)
    ✓ endOfOp guards against missing predicate placeholder (6 ms)
    ✓ endOfOp validates surrounding case metadata (4 ms)
    ✓ endCaseOp emits final drop and patches exits (3 ms)
    ✓ endCaseOp handles empty case by emitting lone drop (2 ms)

 PASS  src/test/ops/lists/query/walk.test.ts
  List query: walk
    ✓ walk simple flat list cells (10 ms)
    ✓ walk nested list payload yields numbers and a LIST ref (6 ms)
    ✓ walk out-of-range resets idx to 0 and yields NIL (4 ms)
    ✓ walk nested ref fetch materializes for pretty print (4 ms)

 PASS  src/test/ops/print/print-operations.test.ts
  Print Operations
    High-level print operation
      simple values
        ✓ should print atomic values correctly (6 ms)
      list operations
        ✓ should print simple lists correctly (3 ms)
        ✓ should print nested lists correctly (4 ms)
      error cases
        ✓ should handle empty stack for print operation (3 ms)
      integration tests
        ✓ should handle multiple print operations (4 ms)
    Low-level raw print operation (raw)
      simple values
        ✓ should print a simple number (5 ms)
        ✓ should print multiple simple values (3 ms)
      list operations
        ✓ should print a tagged value (3 ms)
        ✓ should handle complex list structures (3 ms)
      error cases
        ✓ should handle empty stack (3 ms)
        ✓ should handle multiple empty stack attempts (4 ms)
      integration tests
        ✓ should work with arithmetic operations (3 ms)
        ✓ should work with stack operations (4 ms)
        ✓ should handle mixed print and raw print operations (3 ms)
    Direct invocation edge cases
      ✓ printOp reports formatter failures and leaves stack consistent (3 ms)
      ✓ rawPrintOp handles unexpected errors gracefully (3 ms)

 PASS  src/test/integration/symbol-table-integration.test.ts
  Symbol Table Integration Tests
    Built-in Symbol Integration: register → resolve → execute
      ✓ should handle add operation end-to-end (6 ms)
      ✓ should handle multiple built-in operations (3 ms)
      ✓ should handle arithmetic operations sequence (4 ms)
    Code Symbol Integration: register → resolve → verify
      ✓ should register and resolve code symbols with correct tagged values (3 ms)
      ✓ should handle multiple code symbols with different addresses (5 ms)
      ✓ should maintain symbol table backward compatibility (3 ms)
    Mixed Symbol Types Integration
      ✓ should handle both built-ins and code symbols in same symbol table (4 ms)
      ✓ should execute built-ins while preserving code symbol references (3 ms)
    Error Handling
      ✓ should handle non-existent symbols (3 ms)
      ✓ should handle invalid symbol names (4 ms)
      ✓ should not interfere with existing symbol table functionality (3 ms)
    Complete Workflow Simulation
      ✓ should simulate future @symbol eval workflow (3 ms)
      ✓ should demonstrate unified eval behavior with different code types (3 ms)
    Performance and Memory Verification
      ✓ should handle large numbers of symbols efficiently (14 ms)
      ✓ should maintain consistent memory usage patterns (3 ms)

 PASS  src/test/lang/interpreter-coverage.test.ts
  Interpreter - Branch Coverage
    execute function edge cases
      ✓ should handle debug mode output for valid opcodes (8 ms)
      ✓ should handle debug mode output during error conditions (8 ms)
      ✓ should preserve stack state when encountering errors (3 ms)
      ✓ should reset compiler state after error (3 ms)
    callTacit
      ✓ should be accessible but complex to test directly (3 ms)
    executeProgram edge cases
      ✓ should handle empty code string (3 ms)
      ✓ should handle code with only whitespace and comments (3 ms)

 PASS  src/test/lang/parser-variables.test.ts
  Parser Variable Support
    Variable declaration parsing
      ✓ should parse simple variable declaration (5 ms)
      ✓ should reject var outside function definition (9 ms)
      ✓ should reject var without name (5 ms)
      ✓ should reject var with invalid name token (3 ms)
    Variable reference parsing
      ✓ should parse variable reference within function (4 ms)
      ✓ should handle multiple variables in function (3 ms)
    Symbol table integration
      ✓ should define local variable in symbol table (3 ms)
      ✓ should handle natural shadowing (3 ms)
    Bytecode generation
      ✓ should generate Reserve opcode for function with variables (4 ms)
      ✓ should generate InitVar opcode for variable declarations (3 ms)
      ✓ should generate LocalRef + Fetch for variable references (3 ms)

 PASS  src/test/ops/local-vars/compatibility.test.ts
  Compound Compatibility Checking
    Basic Compatibility Rules
      ✓ should be compatible for same-length lists (5 ms)
      ✓ should be incompatible for different-length lists (3 ms)
      ✓ should be compatible for empty lists (3 ms)
      ✓ should be incompatible for different compound types (3 ms)
      ✓ should be incompatible for non-compound types (3 ms)
    Edge Cases
      ✓ should handle maximum sized lists (4 ms)
      ✓ should handle single-element lists (behavioral assignment) (7 ms)
      ✓ should distinguish empty vs single-element lists (5 ms)
    Behavioral Verification
      ✓ should work with same-content lists (behavioral assignment) (4 ms)
      ✓ should work with different-content but same-length lists (behavioral assignment) (4 ms)

 PASS  src/test/lang/compiler-functions.test.ts
  Compiler Function Context
    Function context tracking
      ✓ should track function compilation state (4 ms)
      ✓ should emit Reserve opcode only when needed (3 ms)
      ✓ should patch slot count on exitFunction (3 ms)
    Integration with function parsing
      ✓ should automatically emit Reserve for functions with variables (5 ms)
      ✓ should handle functions without variables (3 ms)
      ✓ should handle nested function calls with variables (4 ms)
      ✓ should handle multiple functions with different variable counts (4 ms)
    Error conditions
      ✓ should handle exitFunction without enterFunction (3 ms)
      ✓ should handle multiple enterFunction calls (3 ms)

 PASS  src/test/ops/broadcast/add-broadcast-flat.test.ts
  Binary broadcasting: add (flat)
    ✓ comprehensive scenarios (single execution to avoid flakiness) (11 ms)

 PASS  src/test/ops/stack/pick.test.ts
  pick Operation
    simple values
      ✓ should duplicate the top element when index is 0 (like dup) (5 ms)
      ✓ should duplicate the second element when index is 1 (like over) (3 ms)
      ✓ should pick from deeper in the stack (3 ms)
    list operations (LIST semantics)
      ✓ should pick a list from the stack (3 ms)
      ✓ should pick a value over a list (3 ms)
    error cases
      ✓ should throw on stack underflow (9 ms)
      ✓ should throw on negative index (3 ms)
      ✓ should throw when index is out of bounds (3 ms)
      ✓ should throw when stack has only the index (3 ms)

 PASS  src/test/ops/heap/global-heap.test.ts
  Global heap primitives
    ✓ gpush copies simple value to heap and leaves no result (4 ms)
    ✓ gpush copies list payload and leaves no result (3 ms)
    ✓ gpeek materialises list contents without altering heap (3 ms)
    ✓ gpop rewinds heap to previous state (3 ms)
    ✓ gpop rewinds list payload spans (3 ms)
    ✓ gmark + gsweep restore GP to saved mark (3 ms)
    ✓ gpush resolves DATA_REF of simple and copies the value (3 ms)
    ✓ gpeek rejects empty heap (4 ms)
    ✓ gpop throws on empty heap (2 ms)
    ✓ gsweep rejects non-integer marks (2 ms)
    ✓ gsweep rejects out-of-range marks (2 ms)
    ✓ gsweep rejects marks above current heap top (2 ms)
    ✓ gpush reports exhaustion when heap is full (4 ms)

 PASS  src/test/stack/find.test.ts
  findElement
    ✓ should find a simple list (5 ms)
    ✓ should return size 1 for non-list (3 ms)
    ✓ should find nested lists (3 ms)
    ✓ should return size 1 when stack is empty (3 ms)
    ✓ should return size 1 when element is not a list (2 ms)
    ✓ should find a list with offset from the top (3 ms)
    ✓ should find an empty list (3 ms)
    ✓ should return size 1 for invalid list structure (missing LIST tag) (3 ms)
    ✓ should return size 1 for invalid list structure (size mismatch) (2 ms)
    ✓ should handle out of bounds access (2 ms)
    ✓ should find list after pushing other values (3 ms)
    ✓ should handle maximum size list within limits (5 ms)
    ✓ should find elements in sequence (2 ms)
    ✓ should handle list at TOS (2 ms)
    ✓ should handle multiple lists (3 ms)

 PASS  src/test/ops/stack/tuck.test.ts
  tuck Operation
    simple values
      ✓ should duplicate top element under second with simple values (7 ms)
      ✓ should work with multiple simple values on stack (7 ms)
      ✓ should work with negative numbers (11 ms)
      ✓ should work with exactly two elements (10 ms)
    list operations (LIST semantics)
      ✓ should duplicate simple value under a list (14 ms)
      ✓ should duplicate list under simple value (11 ms)
      ✓ should duplicate list under another list (15 ms)
      ✓ should handle multi-element lists (18 ms)
      ✓ should handle nested lists correctly (4 ms)
    error cases
      ✓ should throw on stack underflow with empty stack (18 ms)
      ✓ should throw on stack underflow with only one element (4 ms)
      ✓ should throw on stack underflow with only one list (3 ms)

 PASS  src/test/lang/local-vars-integration.test.ts
  Local Variables Integration with Existing Features
    Integration with basic operations
      ✓ should work with simple calculations (10 ms)
    Integration with control flow
      ✓ should work with IF/ELSE constructs (34 ms)
      ✓ should work with simple conditionals and local variables (6 ms)
    Integration with stack operations
      ✓ should work with dup, swap, rot operations (8 ms)
      ✓ should work with basic stack operations (7 ms)
    Integration with arithmetic operations
      ✓ should work with arithmetic expressions (6 ms)
      ✓ should work with mathematical functions (5 ms)
    Integration with function calls
      ✓ should work with function calls and local variables (5 ms)
      ✓ should work with multiple function calls (8 ms)
    Variable Mutation
      ✓ should support variable mutation using -> operator (8 ms)
      ✓ should support multiple variable mutations with -> (4 ms)
      ✓ should support mutation and reading in sequence with -> (6 ms)

 PASS  src/test/core/vm-constructor.test.ts
  VM Constructor Initialization
    ✓ should initialize memory as a Memory instance (17 ms)
    ✓ should initialize IP to 0 (14 ms)
    ✓ should initialize running to true (16 ms)
    ✓ should initialize SP to STACK_BASE_CELLS (9 ms)
    ✓ should initialize RSP (absolute cells) to RSTACK_BASE_CELLS (59 ms)
    ✓ should initialize BP (absolute cells) to RSTACK_BASE_CELLS (6 ms)
    ✓ should initialize digest as a Digest instance (9 ms)
    ✓ should initialize debug to false (7 ms)
    ✓ should initialize listDepth to 0 (14 ms)
    ✓ should initialize dictionary with builtins (head > 0) (15 ms)
    ✓ should initialize compiler property after constructor call (8 ms)

 PASS  src/test/ops/local-vars/in-place-mutation.test.ts
  In-Place Compound Mutation
    Basic In-Place Mutation
      ✓ should mutate empty list in place (149 ms)
      ✓ should mutate single-element list in place (819 ms)
      ✓ should mutate multi-element list in place (139 ms)
    Compatibility Enforcement
      ✓ should reject incompatible slot counts (546 ms)
      ✓ should reject non-compound mutation attempts (14 ms)
    Memory Layout Verification
      ✓ should preserve memory layout without RP advancement (35 ms)
    Edge Cases
      ✓ should handle nested list mutation correctly (4 ms)
      ✓ should maintain data integrity during mutation (4 ms)

 PASS  src/test/ops/dict/dict-ops.test.ts
  Heap-backed dictionary ops
    ✓ define + lookup simple value (13 ms)
    ✓ define + lookup list value (9 ms)
    ✓ shadowing returns latest definition (5 ms)
    ✓ mark + forget removes entries after mark (9 ms)
    ✓ define rejects non-string name (11 ms)
    ✓ lookup rejects non-string name (5 ms)

 PASS  src/test/ops/core/core-ops-coverage.test.ts
  Core Operations Branch Coverage
    exitOp edge cases
      ✓ should handle return stack underflow (lines 202-203) (6 ms)
      ✓ should handle non-code return address (line 214) (3 ms)
    evalOp branch coverage
      ✓ should handle non-executable values (line 338) (3 ms)
      ✓ should handle string values in eval (3 ms)
      ✓ should handle list values in eval (3 ms)
      ✓ should execute CODE with meta=1 (block) path (3 ms)
    Error handling branches
      ✓ should handle edge case in exitOp (4 ms)
    Integration tests to hit more branches
      ✓ should exercise function return paths (5 ms)
      ✓ should exercise eval with colon definition (6 ms)
      ✓ should exercise function calls (3 ms)
    Code tag variations
      ✓ should handle CODE tag with different meta values (4 ms)
    Stack state edge cases
      ✓ should handle various stack configurations (4 ms)

 PASS  src/test/ops/stack/dup.test.ts
  dup Operation
    simple values
      ✓ should duplicate a simple value (5 ms)
      ✓ should duplicate a regular value (3 ms)
    list operations (LIST semantics)
      ✓ should duplicate a list (3 ms)
      ✓ should duplicate a simple list (2 ms)
      ✓ should duplicate a larger list (3 ms)
      ✓ should duplicate a nested list (3 ms)
    error cases
      ✓ should throw on empty stack (7 ms)

 PASS  src/test/ops/local-vars/tolerant-fetch.test.ts
  Load opcode (value-by-default dereference)
    ✓ simple local: &x load behaves like x (12 ms)
    ✓ compound local: &xs fetch materializes like xs (8 ms)
    ✓ elem + load: (&xs 0 elem load) yields element value (4 ms)
    ✓ slot + tolerant fetch: (&xs 0 slot fetch fetch) yields payload cell value (4 ms)
    ✓ find + tolerant fetch: (&m 2 find fetch fetch) yields mapped value (4 ms)

 PASS  src/test/ops/error-handling/invalid-slot-access.test.ts
  Invalid Slot Access Error Handling
    ✓ should throw error when accessing unallocated local variable slot (beyond total memory) (9 ms)
    ✓ should throw ReturnStackUnderflowError if BP is corrupted and points to invalid location (8 ms)

 PASS  src/test/core/vm-pointer-validation.test.ts
  VM pointer validation
    ✓ SP outside lower bound triggers invariant (11 ms)
    ✓ SP above upper bound triggers invariant (3 ms)
    ✓ SP non-integer triggers invariant (3 ms)
    ✓ RSP negative triggers invariant (3 ms)
    ✓ BP beyond RSP triggers invariant (3 ms)
    ✓ GP negative triggers invariant (3 ms)
    ✓ unsafeSetBPBytes rejects non-aligned offsets (3 ms)
    ✓ ensureInvariants catches negative stack pointers (3 ms)

 PASS  src/test/ops/capsules/dispatch.test.ts
  capsule dispatch runtime
    ✓ prologue consumes receiver only, preserves method and args (5 ms)
    ✓ errors on non-capsule receiver (6 ms)

 PASS  src/test/ops/stack/stack-utils.test.ts
  Stack Utils
    rangeRoll
      ✓ should handle empty ranges (5 ms)
      ✓ should handle zero shift amount (3 ms)
    findElement
      ✓ should return size 1 when stack is empty (3 ms)
      ✓ should find elements in sequence (6 ms)
      ✓ should handle list at TOS (6 ms)
      ✓ should handle multiple lists (5 ms)

 PASS  src/test/ops/local-vars/local-variables.test.ts
  Local Variables System
    Basic Operations
      ✓ should handle complete workflow: reserve → init → fetch (5 ms)
      ✓ should handle different data types (6 ms)
    Multiple Variables
      ✓ should handle multiple variables without interference (3 ms)
      ✓ should handle slot overwrites (3 ms)
    Frame Isolation
      ✓ should isolate variables between different function frames (3 ms)
    Edge Cases
      ✓ should handle large slot numbers (3 ms)
      ✓ should handle many variables efficiently (3 ms)
    Integration with Operations
      ✓ should work with arithmetic operations (3 ms)
      ✓ should work with do combinator (3 ms)
    Variable Mutation
      ✓ should support variable mutation via writeReference (3 ms)
      ✓ should handle multiple variable mutations (2 ms)
      ✓ should maintain isolation during mixed read/write operations (2 ms)

 PASS  src/test/ops/core/branch-coverage-extra.test.ts
  Core ops extra branch coverage
    ✓ groupRightOp underflow throws (13 ms)
    ✓ endIfOp errors on missing placeholder (3 ms)
    ✓ endDoOp errors on missing predicate placeholder (3 ms)
    ✓ groupLeft/groupRight normal path counts pushes (3 ms)
    ✓ exitOp stops VM when no caller frame (3 ms)
    ✓ exitOp restores return address when non-CODE (raw) (3 ms)
    ✓ exitOp restores return address when numeric (3 ms)
    ✓ endIfOp patches a branch placeholder correctly (3 ms)

 PASS  src/test/core/vm-stack-operations.test.ts
  VM Stack Operations Error Handling
    ✓ should throw StackOverflowError when data stack overflows (12 ms)
    ✓ should throw ReturnStackOverflowError when return stack overflows (3 ms)
    ✓ StackOverflowError should contain correct stack state (3 ms)
    ✓ ReturnStackOverflowError should contain correct stack state (3 ms)
    ✓ should throw StackUnderflowError when pop is called on empty stack (4 ms)
    ✓ should throw StackUnderflowError when peek is called on empty stack (3 ms)
    ✓ should throw StackUnderflowError when popArray is called with insufficient elements (3 ms)
    ✓ should throw StackUnderflowError when popArray is called on empty stack (6 ms)

 PASS  src/test/ops/local-vars/ref-assign-fast-path.test.ts
  Ref-to-list assignment fast path
    ✓ `&x -> y` copies list without materializing x (8 ms)
    ✓ self-assignment `&x -> x` is a no-op (4 ms)
    ✓ copy sublist into sibling via bracketed destination (5 ms)

 PASS  src/test/ops/lists/query/addressing-slot-elem.test.ts
  List addressing operations: slot/elem
    ✓ slot returns address for payload slot (7 ms)
    ✓ elem returns address for logical element (4 ms)
    ✓ slot out of range returns NIL (3 ms)
    ✓ elem out of range returns NIL (4 ms)
    ✓ negative indices return NIL (slot/elem) (3 ms)

 PASS  src/test/ops/stack/rot.test.ts
  rot Operation
    simple values
      ✓ should rotate three simple values (5 ms)
      ✓ should rotate with more values on stack (3 ms)
    list operations (LIST semantics)
      ✓ should rotate a list with two simple values (3 ms)
      ✓ should rotate three lists (3 ms)
      ✓ should handle nested lists (3 ms)
    error cases
      ✓ should throw on insufficient stack depth (8 ms)
      ✓ should throw on empty stack (3 ms)

  console.log
    Loading 1 file(s)...

      at startREPL (src/lang/repl.ts:40:13)

  console.log
    All files loaded successfully.

      at startREPL (src/lang/repl.ts:51:15)

  console.log
    Loading 1 file(s)...

      at startREPL (src/lang/repl.ts:40:13)

  console.error
    Error processing file: bad.tac

      42 |       const success = processFile(vm, file);
      43 |       if (!success) {
    > 44 |         console.error(`Error processing file: ${file}`);
         |                 ^
      45 |         allFilesProcessed = false;
      46 |       }
      47 |     }

      at startREPL (src/lang/repl.ts:44:17)
      at src/test/lang/repl.coverage.test.ts:30:27
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/test/lang/repl.coverage.test.ts:30:53)

  console.log
    Some files had errors but REPL will continue.

      at startREPL (src/lang/repl.ts:54:15)

 PASS  src/test/lang/repl.coverage.test.ts
  repl.startREPL non-interactive coverage
    ✓ returns early when interactiveAfterFiles is false with no files (5 ms)
    ✓ processes files successfully (allFilesProcessed true) without entering interactive mode (9 ms)
    ✓ handles file processing error path (allFilesProcessed false) (5 ms)

 PASS  src/test/lang/tokenizer-symbol.test.ts
  Tokenizer @symbol Support - Step 13
    Basic @symbol tokenization
      ✓ should tokenize a simple @symbol (1 ms)
      ✓ should tokenize multiple @symbols
      ✓ should tokenize @symbols with underscores and hyphens
      ✓ should tokenize @symbols with numbers (1 ms)
    @symbol edge cases
      ✓ should throw error for @ without symbol name (3 ms)
      ✓ should throw error for @ followed by whitespace (1 ms)
      ✓ should throw error for @ followed by special character
      ✓ should handle @ at end of input
    @symbol integration with other tokens
      ✓ should tokenize mixed @symbols and words
      ✓ should tokenize @symbols with special characters (1 ms)
      ✓ should tokenize @symbols in word definitions (3 ms)
    @symbol position tracking
      ✓ should track positions correctly for @symbols
      ✓ should handle line and column tracking for @symbols
    @symbol boundary conditions
      ✓ should stop at whitespace after @symbol
      ✓ should stop at special characters after @symbol
      ✓ should handle @symbol at end of input

 PASS  src/test/core/list-memory.test.ts
  LIST Memory Management Validation
    ✓ creates and drops a large LIST without leaving residual stack data (7 ms)
    ✓ handles nested LIST creation and drop in sequence (3 ms)

  console.log
    Stack: 2(NUMBER)

      at logStack (src/test/utils/vm-test-utils.ts:339:11)

 PASS  src/test/ops/lists/build/list-creation.test.ts
  List Creation Operations
    simple values
      ✓ should create a simple list with 2 elements (9 ms)
      ✓ should handle empty lists (3 ms)
    list operations
      ✓ should handle a nested list with 1 level of nesting (3 ms)
      ✓ should handle multiple nested lists at the same level (4 ms)
    integration tests
      ✓ should handle complex mixed nested structures (3 ms)
      ✓ should handle deeply nested lists (3+ levels) (6 ms)

 PASS  src/test/ops/capsules/layout.test.ts
  capsule layout (handle-based)
    ✓ reads valid capsule layout from DATA_REF handle (7 ms)
    ✓ errors on non-capsule handle (slot0 not CODE) (4 ms)
    ✓ errors on non-list handle (bad reference) (3 ms)
    ✓ reads capsule layout when list lives on STACK segment (3 ms)
    ✓ errors when payload slot count is zero (3 ms)
    ✓ errors when return-stack DATA_REF does not point to a LIST header (3 ms)

 PASS  src/test/ops/capsules/assertions.test.ts
  capsule assertions
    ✓ accepts well-formed capsule (5 ms)
    ✓ rejects non-list values (4 ms)
    ✓ rejects capsule without code reference (3 ms)

 PASS  src/test/lang/ref-sigil.test.ts
  Reference Sigil (&x) Parsing
    ✓ should parse &x sigil for local variables (6 ms)
    ✓ should differentiate between x and &x behavior (5 ms)
    ✓ should reject &x for undefined names at top level (10 ms)
    ✓ should reject &x for undefined variables (4 ms)
    ✓ should reject &x for non-local variables (3 ms)

 PASS  src/test/lang/parser-list.test.ts
  Parser LIST Integration (() )
    ✓ parses simple LIST literal: ( 1 2 3 ) and builds LIST on stack (6 ms)
    ✓ parses nested LIST: ( 1 ( 2 3 ) 4 ) (3 ms)
    ✓ throws on unmatched LIST closing bracket (7 ms)
    ✓ throws on unmatched LIST opening bracket (3 ms)

 PASS  src/test/lang/conditionals-immediate.test.ts
  conditional immediates
    ✓ ELSE without open IF throws (9 ms)
    ✓ ELSE rejects mismatched closer (3 ms)
    ✓ ELSE requires placeholder beneath closer (3 ms)
    ✓ ELSE complains about missing branch placeholder (3 ms)
    ✓ ELSE complains about invalid branch placeholder (3 ms)
    ✓ ELSE patches placeholder and installs exit branch (3 ms)
    ✓ ensureNoOpenConditionals detects unclosed IF (3 ms)
    ✓ ensureNoOpenConditionals detects unclosed when (2 ms)
    ✓ ensureNoOpenConditionals passes on clean stack (3 ms)

 PASS  src/test/ops/lists/build/pack-unpack.unified.test.ts
  List build ops (pack/unpack) unified memory coverage
    ✓ pack with count 0 creates empty list (6 ms)
    ✓ pack with count > stack length yields NIL (3 ms)
    ✓ unpack on non-list leaves stack in a valid state (4 ms)
    ✓ unpack on empty list yields no items (5 ms)
    ✓ unpack on stack-resident list leaves payload on stack (3 ms)

 PASS  src/test/ops/stack/swap.test.ts
  swap Operation
    simple values
      ✓ should swap two simple values (5 ms)
      ✓ should swap top two values on deeper stack (3 ms)
    list operations (LIST semantics)
      ✓ should swap a simple list with a value (3 ms)
      ✓ should swap a value with a simple list (3 ms)
      ✓ should swap two simple lists (3 ms)
      ✓ should handle empty lists during swap (3 ms)
    error cases
      ✓ should throw error when trying to swap with insufficient items (6 ms)
      ✓ should throw on empty stack (3 ms)

 PASS  src/test/core/vm-ip-operations.test.ts
  VM Instruction Pointer Operations
    ✓ next8 should read a byte and advance IP by 1 (4 ms)
    ✓ nextOpcode should read a single-byte opcode and advance IP by 1 (2 ms)
    ✓ nextOpcode should read a two-byte opcode and advance IP by 2 (4 ms)
    ✓ nextInt16 should read a 16-bit signed integer and advance IP by 2 (3 ms)
    ✓ nextFloat32 should read a 32-bit float and advance IP by CELL_SIZE (3 ms)
    ✓ nextAddress should read a tagged address and advance IP by CELL_SIZE (2 ms)
    ✓ nextUint16 should read a 16-bit unsigned integer and advance IP by 2 (3 ms)
    ✓ IP should advance correctly across mixed reads (3 ms)

 PASS  src/test/lang/capsules/capsule-registration.test.ts
  capsule word registration
    ✓ capsule is registered as immediate (5 ms)
    ✓ dispatch builtin maps to opcode (3 ms)

 PASS  src/test/ops/local-vars/initvar.test.ts
  InitVar Opcode
    ✓ should store value in correct slot (5 ms)
    ✓ should handle slot 0 (2 ms)
    ✓ should handle negative values (2 ms)
    ✓ should handle large slot numbers (2 ms)
    ✓ should handle floating point values (6 ms)
    ✓ should throw on stack underflow (8 ms)
    ✓ should handle multiple sequential initializations (3 ms)
    ✓ should overwrite existing slot values (3 ms)

 PASS  src/test/ops/local-vars/compound-mutation.test.ts
  Compound Variable Mutation
    ✓ should perform compatible compound assignment (8 ms)
    ✓ should throw error for incompatible compound assignment (7 ms)
    ✓ should throw error for assigning simple to compound (4 ms)
    ✓ should throw error for assigning compound to simple (4 ms)

 PASS  src/test/ops/capsules/stubs.test.ts
  capsule opcode stubs
    ✓ exitConstructorOp produces capsule handle and restores caller (5 ms)
    ✓ exitDispatchOp underflow outside prologue (7 ms)
    ✓ dispatchOp underflow without operands (3 ms)
    ✓ endCapsuleOp errors outside parser context (4 ms)

 PASS  src/test/cli/cli.test.ts
  CLI
    ✓ should start REPL with no files when none are provided (2 ms)
    ✓ should start REPL with files in interactive mode by default
    ✓ should process files without REPL when --no-interactive flag is used

 PASS  src/test/ops/lists/query/fetch-store.test.ts
  List reference operations: fetch/store
    ✓ fetch simple value via slot ref (6 ms)
    ✓ fetch compound value via elem ref yields materialized structure (3 ms)
    ✓ store simple value into slot ref (3 ms)
    ✓ fetch throws on non-reference input (9 ms)
    ✓ load materializes list from return-stack reference (&local) (4 ms)

 PASS  src/test/ops/control/control-ops.test.ts
  Control Operations - Branch Coverage
    ifFalseBranchOp edge cases
      ✓ should handle non-number conditions by treating them as falsy (5 ms)
      ✓ should not jump when condition is truthy number (3 ms)
      ✓ should jump when condition is zero (3 ms)

 PASS  src/test/ops/access/select-helper-functions.test.ts
  selectOp Helper Functions
    createTargetRef
      ✓ should create ref for LIST target (6 ms)
      ✓ should handle existing DATA_REF target (4 ms)
      ✓ should return NIL for simple value target (3 ms)
    handleSimplePath
      ✓ should handle numeric path element (4 ms)
      ✓ should handle string path element (4 ms)

 PASS  src/test/lang/clean-exit-test.test.ts
  Function Exit Behavior
    ✓ should properly restore BP after function call (6 ms)
    ✓ should properly restore BP after function with local variables (4 ms)
    ✓ should handle nested function calls correctly (4 ms)

 PASS  src/test/stack/slots.test.ts
  rangeRoll
    ✓ should handle empty range (5 ms)
    ✓ should handle zero shift (2 ms)
    ✓ should roll simple values right (3 ms)
    ✓ should roll simple values left (3 ms)
    ✓ should handle shift amounts larger than range size (3 ms)
  reverseRange
    ✓ should reverse a range of elements (3 ms)
    ✓ should handle empty range (3 ms)
    ✓ should handle single element range (3 ms)

 PASS  src/test/ops/broadcast/binary-recursive.test.ts
  Recursive broadcasting: add
    ✓ scalar broadcast over nested list (scalar on left) (7 ms)
    ✓ type mismatch surfaces broadcast error (7 ms)

 PASS  src/test/lang/literals.test.ts
  literal emission helpers
    ✓ emitNumber compiles numeric literal opcodes (1 ms)
    ✓ emitString interns the string and compiles address (1 ms)

 PASS  src/test/core/utils.test.ts
  Utility Functions
    Character check functions
      ✓ isDigit returns true for digit characters (1 ms)
      ✓ isDigit returns false for non-digit characters (1 ms)
      ✓ isWhitespace returns true for whitespace characters
      ✓ isWhitespace returns false for non-whitespace characters
      ✓ isGroupingChar returns true for grouping characters
      ✓ isGroupingChar returns false for non-grouping characters
    Logical and conversion functions
      ✓ toUnsigned16 converts numbers to 16-bit (1 ms)
      ✓ toBoolean returns true for non-zero and false for zero
      ✓ toNumber converts boolean to number
      ✓ not returns the logical negation
      ✓ and returns correct logical and (1 ms)
      ✓ or returns correct logical or
      ✓ xor returns correct logical exclusive or
    formatValue function
      ✓ returns value.toString() for non-tagged values
      ✓ formats FLOAT tagged value
      ✓ formats INTEGER tagged value (non-zero) (1 ms)
      ✓ formats INTEGER tagged value representing NIL
      ✓ formats CODE tagged value
      ✓ formats STRING tagged value successfully
      ✓ formats STRING tagged value when digest.get throws

 PASS  src/test/core/memory.test.ts
  Memory
    ✓ should write and read 8-bit values correctly (1 ms)
    ✓ should write and read Float32 values correctly
    ✓ should throw error for out-of-bounds access (3 ms)
    ✓ should dump memory for debugging
    ✓ should write and read 16-bit values correctly
    ✓ should throw RangeError for 16-bit boundary violations
    ✓ should handle invalid dump ranges (1 ms)
    ✓ should handle full float boundary conditions
    ✓ should handle dumping memory as characters
    ✓ should handle invalid dumpChars ranges (1 ms)

 PASS  src/test/repl/list-repl.test.ts
  REPL LIST display
    ✓ prints simple LIST (6 ms)
    ✓ prints nested LIST (3 ms)

 PASS  src/test/core/tagged-meta.test.ts
  Tagged Value Meta Bit Support
    toTaggedValue with meta bit
      ✓ should create tagged value with meta=0 (default) (1 ms)
      ✓ should create tagged value with meta=0 (explicit)
      ✓ should create tagged value with meta=1
      ✓ should work with different tag types and meta=1
      ✓ should throw error for invalid meta bit values (3 ms)
      ✓ should throw error when trying to set meta bit on NUMBER tag
    fromTaggedValue with meta bit
      ✓ should return meta=0 for NUMBER tags
      ✓ should preserve meta bit across round-trip encoding
    meta bit distinctness
      ✓ should create different NaN values for same value/tag but different meta bits
    backward compatibility
      ✓ should work with existing code that destructures without meta

 PASS  src/test/lang/tokenizer.test.ts
  Tokenizer
    ✓ should tokenize a simple command (1 ms)
    ✓ should tokenize a command with multiple operations
    ✓ should tokenize positive integers
    ✓ should tokenize negative integers
    ✓ should tokenize positive floats
    ✓ should tokenize negative floats
    ✓ should tokenize explicit positive numbers (3 ms)
    ✓ should handle numbers adjacent to special characters
    ✓ should tokenize words like swap and drop
    ✓ should tokenize mixed input with numbers and words (1 ms)
    ✓ should tokenize special characters
    ✓ should handle standalone operators
    ✓ should skip empty lines
    ✓ should skip lines with only comments
    ✓ should skip inline comments
    ✓ should handle multiple spaces and empty words
    ✓ should handle mixed input with numbers, words, and special characters
    ✓ should handle multiple lines with mixed content
    ✓ should handle empty input
    ✓ should tokenize complex expressions
    ✓ should handle nested expressions
    ✓ should handle numbers with leading zeros
    ✓ should handle words with mixed case (1 ms)
    ✓ should handle ( and ) as symbol terminators
    ✓ should handle ( and ) in complex expressions
    ✓ should handle [ and ] as symbol terminators (1 ms)
    ✓ should handle [ and ] in complex expressions
    ✓ should handle words with underscores
    ✓ should track token positions correctly
    ✓ should track line and column numbers
    ✓ should allow pushing back a token (2 ms)
    ✓ should throw error when pushing back multiple tokens (3 ms)
    ✓ should tokenize string literals (1 ms)
    ✓ should handle escaped characters in strings
    ✓ should throw error for unterminated string
    ✓ should handle mixed strings and other tokens
    ✓ should handle special characters inside strings
    ✓ should handle empty strings
    ✓ should handle strings with escaped characters
    ✓ should handle strings at the end of input

 PASS  src/test/strings/dictionary-builtins.test.ts
  dictionary-only builtins
    ✓ defineBuiltin then lookup returns BUILTIN with opcode (5 ms)
    ✓ defineBuiltin (immediate) then lookup returns BUILTIN with meta=1 (3 ms)
    ✓ lookup walks to previous entry (two entries) (4 ms)

 PASS  src/test/lang/list-compilation.test.ts
  LIST Literal Compilation
    ✓ compiles a simple LIST literal: ( 1 2 3 ) (5 ms)
    ✓ compiles nested LIST literal: ( 1 ( 2 3 ) 4 ) (3 ms)

 PASS  src/test/core/units.test.ts
  cell unit helpers
    ✓ constructors validate non-negative integers (5 ms)
    ✓ asBytes and asCells round-trip aligned values (2 ms)
    ✓ loadCell and storeCell operate on cell granularity (1 ms)
    ✓ copyCells handles no-ops and overlapping ranges
    ✓ fillCells writes repeated values (1 ms)

 PASS  src/test/core/unified-data-ref.test.ts
  DATA_REF utilities
    ✓ createDataRef encodes absolute cell indices and region classification (5 ms)
    ✓ createDataRef validates absolute bounds (5 ms)
    ✓ getAbsoluteCellIndexFromRef enforces arena bounds (3 ms)
    ✓ createGlobalRef produces data ref in global segment (3 ms)
    ✓ getVarRef returns DATA_REF to return-stack slot (2 ms)
    ✓ getByteAddressFromRef resolves absolute address (3 ms)
    ✓ readRefValue operates via DATA_REF (3 ms)
    ✓ fetchOp materializes value via DATA_REF (3 ms)
    ✓ storeOp writes value via DATA_REF (3 ms)

 PASS  src/test/core/printer.test.ts
  Printer
    prn
      ✓ should print NUMBER tagged values (2 ms)
      ✓ should print CODE tagged values
      ✓ should print STRING tagged values
      ✓ should print LIST tagged values
      ✓ should handle empty title (2 ms)
      ✓ should handle null title
      ✓ should handle untagged NUMBER values
      ✓ should handle special float values (1 ms)
      ✓ should handle unknown tag types gracefully
      ✓ should format output correctly with indentation (1 ms)
      ✓ should handle large string indices
      ✓ should handle edge case values for different tag types
      ✓ should work with LIST tag values of different sizes
    integration with tagged values
      ✓ should correctly format all standard tag types (1 ms)
      ✓ should handle multiple consecutive prints

 PASS  src/test/ops/local-vars/reserve.test.ts
  Reserve Operation
    ✓ should allocate slots correctly (4 ms)
    ✓ should allocate zero slots (3 ms)
    ✓ should allocate single slot (3 ms)
    ✓ should allocate maximum 16-bit slots (2 ms)
    ✓ should handle multiple allocations (3 ms)
    ✓ should advance IP correctly (2 ms)

 PASS  src/test/ops/local-vars/ref-assign-cross-segment.test.ts
  Cross-segment ref-to-list store
    ✓ Stack DATA_REF -> return-stack DATA_REF (literal list ref into local) (10 ms)
    ✓ Return-stack DATA_REF -> stack DATA_REF (local compound into stack list via ref/store) (5 ms)

 PASS  src/test/ops/dict/find-add-after-reset.test.ts
  find add after reset
    ✓ add is resolvable (5 ms)

 PASS  src/test/ops/dict/define-and-lookup-builtin.test.ts
  dict define/lookup builtin (happy path)
    ✓ define builtin then lookup returns DATA_REF to stored BUILTIN (5 ms)

 PASS  src/test/core/tagged-local.test.ts
  Tag.LOCAL Tagged Values
    ✓ should create LOCAL tagged value with slot number (1 ms)
    ✓ should handle 16-bit slot numbers
    ✓ should handle slot number zero
    ✓ should not identify non-LOCAL values as LOCAL (1 ms)
    ✓ should validate slot number bounds (2 ms)
    ✓ should work with meta bits

 PASS  src/test/lang/capsules/capsule-integration.frame-extend.test.ts
  Capsule stored in function local (frame extension)
    ✓ function creates counter capsule, stores in local, dispatches (11 ms)

 PASS  src/test/core/tagged.test.ts
  Tagged NaN Encoding
    ✓ should correctly decode encoded values (1 ms)
    ✓ should throw on invalid tag ranges (2 ms)
    ✓ should validate value ranges for INTEGER
    ✓ should validate unsigned value ranges for non-INTEGER types
    ✓ should correctly extract value for integer types
    ✓ should return the correct tag using getTag
    ✓ should return the correct value using getValue
    ✓ should correctly identify NIL using isNIL
    ✓ should correctly identify code types

 PASS  src/test/ops/lists/query/keys-values.coverage.test.ts
  keysOp/valuesOp branch coverage
    ✓ keysOp on empty list returns empty list header (5 ms)
    ✓ valuesOp on empty list returns empty list header (3 ms)
    ✓ keysOp on odd slotCount returns NIL (3 ms)
    ✓ valuesOp on odd slotCount returns NIL (3 ms)

 PASS  src/test/ops/stack/over.test.ts
  over Operation
    simple values
      ✓ should duplicate the second item (simple values) (5 ms)
      ✓ should work with multiple values on stack (3 ms)
    list operations (LIST semantics)
      ✓ should duplicate a value over a list (3 ms)
      ✓ should handle nested lists correctly (2 ms)
    error cases
      ✓ should throw on insufficient stack (5 ms)
      ✓ should throw on empty stack (3 ms)

 PASS  src/test/lang/capsules/capsule-nested.dispatch.test.ts
  Nested capsules - outer dispatch triggers inner dispatch
    ✓ outer inc forwards to inner inc; both counts advance (15 ms)

 PASS  src/test/lang/compiler-hooks.test.ts
  compiler-hooks
    ✓ invokes the end definition handler (5 ms)
    ✓ throws when no handler is registered (3 ms)

 PASS  src/test/lang/capsules/capsule-dispatch.degenerate.test.ts
  Capsule dispatch (degenerate body)
    ✓ dispatch ignores message and returns constant (7 ms)

 PASS  src/test/core/refs.absolute-helpers.test.ts
  Absolute DATA_REF helpers (Phase A)
    ✓ createDataRef and decodeDataRef round-trip (1 ms)
    ✓ createDataRef throws on out-of-bounds (2 ms)
    ✓ createDataRef throws on negative index (1 ms)
    ✓ decodeDataRef rejects non-DATA_REF values

 PASS  src/test/core/code-ref.test.ts
  Code Reference Utilities
    createBuiltinRef
      ✓ should create valid builtin references (1 ms)
      ✓ should handle various valid opcodes
      ✓ should reject invalid opcodes (2 ms)
    createCodeRef
      ✓ should create valid code references
      ✓ should handle various valid addresses (1 ms)
      ✓ should reject invalid addresses (3 ms)
    isBuiltinRef
      ✓ should identify builtin references correctly
      ✓ should reject non-builtin references
      ✓ should handle malformed values gracefully
    isFuncRef
      ✓ should identify code references correctly
      ✓ should reject non-code references
      ✓ should handle malformed values gracefully (1 ms)
    isExecutableRef
      ✓ should identify all executable references
      ✓ should reject non-executable values
    getBuiltinOpcode
      ✓ should extract opcode from valid builtin references
      ✓ should reject non-builtin references (1 ms)
    getCodeAddress
      ✓ should extract address from valid code references
      ✓ should reject non-code references (1 ms)
    integration with evalOp
      ✓ should create references compatible with enhanced evalOp
      ✓ should roundtrip through creation and extraction

 PASS  src/test/core/builtin-tag.test.ts
  Tag.BUILTIN functionality
    ✓ should create and decode BUILTIN tagged values (1 ms)
    ✓ should handle various opcodes
    ✓ should validate BUILTIN value ranges (3 ms)

 PASS  src/test/ops/lists/query/find-maplist-basic.test.ts
  Basic Maplist Tests
    ✓ find operation should return something that is not NIL for existing key (6 ms)
    ✓ keys operation should not crash (5 ms)
    ✓ values operation should not crash (3 ms)
    ✓ find operation with string keys (4 ms)
    ✓ find operation with reference targets (4 ms)
    ✓ basic string equality test (3 ms)

 PASS  src/test/core/vm-abs-registers.test.ts
  VM absolute registers (Phase B shims)
    ✓ sp/rsp/bp/gp reflect absolute cell indices after reset (4 ms)
    ✓ push/rpush update sp/rsp fields (2 ms)

 PASS  src/test/lang/capsules/capsule-integration.counter.test.ts
  Counter capsule (case/of)
    ✓ inc and get update and read state via dispatch (10 ms)

 PASS  src/test/ops/strings/digest.test.ts
  Digest
    ✓ should add a string, retrieve it, and report its length (1 ms)
    ✓ should correctly handle an empty string
    ✓ should correctly handle strings with special characters
    ✓ should correctly handle a string with maximum length
    ✓ should throw an error if the string is too long (1 ms)
    ✓ should throw an error if there is not enough space in memory (1 ms)
    ✓ should find an existing string and return -1 for a non-existent string
    ✓ intern should return the same address for duplicates and a different address for new strings (1 ms)
    ✓ should correctly handle adding and retrieving multiple strings
    ✓ should throw an error when reading from an invalid address
    ✓ should correctly report remaining space (1 ms)

 PASS  src/test/ops/strings/string.test.ts
  stringCreate
    ✓ should create a tagged string with Tag.STRING (1 ms)
    ✓ should create distinct tagged strings for multiple calls
    ✓ should handle empty strings correctly
    ✓ should throw an error if the string exceeds maximum length (2 ms)
    ✓ should correctly store multiple strings in sequence (1 ms)
    ✓ should report the correct length for a non-empty string
    ✓ should report the correct length for an empty string

 PASS  src/test/ops/lists/query/ref-op.coverage.test.ts
  refOp coverage
    ✓ refOp pushes reference for LIST at TOS (5 ms)
    ✓ refOp no-op for non-LIST TOS (5 ms)

Summary of all failing tests
 FAIL  src/test/ops/lists/structure/reverse.test.ts
  ● List reverse operation › reverse empty list returns empty list

    expect(received).toEqual(expected) // deep equality

    - Expected  - 1
    + Received  + 0

      Array [
        NaN,
    -   NaN,
      ]

      21 |
      22 |     const original = executeTacitCode(vm, '( )');
    > 23 |     expect(stack).toEqual(original);
         |                   ^
      24 |   });
      25 |
      26 |   test('reverse single element list returns same list', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/reverse.test.ts:23:19)

  ● List reverse operation › reverse single element list returns same list

    expect(received).toEqual(expected) // deep equality

    - Expected  - 2
    + Received  + 0

      Array [
        42,
        NaN,
    -   42,
    -   NaN,
      ]

      29 |
      30 |     const expected = executeTacitCode(vm, '( 42 )');
    > 31 |     expect(stack).toEqual(expected);
         |                   ^
      32 |   });
      33 |
      34 |   test('reverse two element list', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/reverse.test.ts:31:19)

  ● List reverse operation › reverse twice returns original list

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 4

      Array [
        3,
        2,
        1,
        NaN,
    +   3,
    +   2,
    +   1,
    +   NaN,
      ]

      64 |     const reversed = executeTacitCode(vm, '( 1 2 3 ) reverse reverse');
      65 |
    > 66 |     expect(reversed).toEqual(original);
         |                      ^
      67 |   });
      68 |
      69 |   test('reverse with non-list value returns NIL', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/reverse.test.ts:66:22)

  ● List reverse operation › reverse with nested lists

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 5

    @@ -7,6 +7,11 @@
        3,
        2,
        1,
        NaN,
        NaN,
    +   3,
    +   2,
    +   1,
    +   NaN,
    +   NaN,
      ]

      81 |     const original = executeTacitCode(vm, '( ( 1 2 ) 3 )');
      82 |     const doubleReversed = executeTacitCode(vm, '( ( 1 2 ) 3 ) reverse reverse');
    > 83 |     expect(doubleReversed).toEqual(original);
         |                            ^
      84 |   });
      85 | });
      86 |

      at Object.<anonymous> (src/test/ops/lists/structure/reverse.test.ts:83:28)

 FAIL  src/test/integration/advanced-operations.test.ts
  ● Tacit Advanced Operations › word definitions

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 1

      Array [
    +   9,
        20,
      ]

      14 |     expect(result).toEqual([9]);
      15 |     result = runTacitTest(vm, ': double 2 mul ; : quadruple double double ; 5 quadruple');
    > 16 |     expect(result).toEqual([20]);
         |                    ^
      17 |     result = runTacitTest(vm, ': swap-and-add swap add ; 3 7 swap-and-add');
      18 |     expect(result).toEqual([10]);
      19 |   });

      at Object.<anonymous> (src/test/integration/advanced-operations.test.ts:16:20)

 FAIL  src/test/lang/interpreter.test.ts
  ● Interpreter › Error handling › should handle non-Error exceptions

    expect(received).toThrow(expected)

    Expected substring: "Error executing word (stack: [5,3])"

    Received function did not throw

      86 |         throw 'Raw string error';
      87 |       });
    > 88 |       expect(() => executeTacitCode(vm, '5 3 add')).toThrow('Error executing word (stack: [5,3])');
         |                                                     ^
      89 |       jest.restoreAllMocks();
      90 |     });
      91 |     test('should preserve stack state on error', () => {

      at Object.<anonymous> (src/test/lang/interpreter.test.ts:88:53)

 FAIL  src/test/ops/local-vars/increment-operator.test.ts
  ● Increment operator +> (locals-only) › bracket path increments › parity with desugared form on bracket path

    expect(received).toEqual(expected) // deep equality

    - Expected  - 3
    + Received  + 0

      Array [
        20,
        17,
        NaN,
    -   20,
    -   17,
    -   NaN,
      ]

      158 |       );
      159 |
    > 160 |       expect(sugar).toEqual(desugared);
          |                     ^
      161 |     });
      162 |   });
      163 | });

      at Object.<anonymous> (src/test/ops/local-vars/increment-operator.test.ts:160:21)

 FAIL  src/test/lang/when-do-control-flow.test.ts
  ● when/do control flow › supports multiple clauses with shared exit

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 1

      Array [
    +   111,
        222,
      ]

      55 |
      56 |     const lessThanThree = executeTacitCode(vm, `2 ${program}`);
    > 57 |     expect(lessThanThree).toEqual([222]);
         |                           ^
      58 |
      59 |     const otherwise = executeTacitCode(vm, `5 ${program}`);
      60 |     expect(otherwise).toEqual([333]);

      at Object.<anonymous> (src/test/lang/when-do-control-flow.test.ts:57:27)

  ● when/do control flow › allows nested when blocks inside the default region

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 1

      Array [
    +   200,
        300,
      ]

      73 |
      74 |     const nestedDefault = executeTacitCode(vm, `2 ${program}`);
    > 75 |     expect(nestedDefault).toEqual([300]);
         |                           ^
      76 |   });
      77 |
      78 |   test('raises when do appears without a surrounding when', () => {

      at Object.<anonymous> (src/test/lang/when-do-control-flow.test.ts:75:27)

 FAIL  src/test/lang/case-control-flow.test.ts
  ● case control flow › supports multiple clauses with shared exit and default

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 1

      Array [
    +   111,
        222,
      ]

      54 |
      55 |     const zero = executeTacitCode(vm, `0 ${program}`);
    > 56 |     expect(zero).toEqual([222]);
         |                  ^
      57 |
      58 |     const other = executeTacitCode(vm, `5 ${program}`);
      59 |     expect(other).toEqual([333]);

      at Object.<anonymous> (src/test/lang/case-control-flow.test.ts:56:18)

  ● case control flow › allows nested case constructs inside clause bodies

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 1

      Array [
    +   999,
        200,
      ]

      77 |
      78 |     const nestedDefault = executeTacitCode(vm, `5 ${program}`);
    > 79 |     expect(nestedDefault).toEqual([200]);
         |                           ^
      80 |   });
      81 |
      82 |   test('first DEFAULT wins when multiple defaults are present', () => {

      at Object.<anonymous> (src/test/lang/case-control-flow.test.ts:79:27)

 FAIL  src/test/integration/basic-operations.test.ts
  ● Tacit Basic Operations › arithmetic operations

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 1

      Array [
    +   8,
        7,
      ]

      14 |     expect(result).toEqual([8]);
      15 |     result = runTacitTest(vm, '10 3 sub');
    > 16 |     expect(result).toEqual([7]);
         |                    ^
      17 |     result = runTacitTest(vm, '5 3 mul');
      18 |     expect(result).toEqual([15]);
      19 |     result = runTacitTest(vm, '15 3 div');

      at Object.<anonymous> (src/test/integration/basic-operations.test.ts:16:20)

  ● Tacit Basic Operations › stack operations

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 2

      Array [
        5,
    +   5,
    +   5,
      ]

      24 |     expect(result).toEqual([5, 5]);
      25 |     result = runTacitTest(vm, '5 3 drop');
    > 26 |     expect(result).toEqual([5]);
         |                    ^
      27 |     result = runTacitTest(vm, '5 3 swap');
      28 |     expect(result).toEqual([3, 5]);
      29 |   });

      at Object.<anonymous> (src/test/integration/basic-operations.test.ts:26:20)

  ● Tacit Basic Operations › comparison operations

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 1

      Array [
    +   1,
        0,
      ]

      32 |     expect(result).toEqual([1]);
      33 |     result = runTacitTest(vm, '5 10 gt');
    > 34 |     expect(result).toEqual([0]);
         |                    ^
      35 |     result = runTacitTest(vm, '5 5 eq');
      36 |     expect(result).toEqual([1]);
      37 |     result = runTacitTest(vm, '5 6 eq');

      at Object.<anonymous> (src/test/integration/basic-operations.test.ts:34:20)

  ● Tacit Basic Operations › if operator (new immediate syntax)

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 1

      Array [
    +   10,
        20,
      ]

      42 |     expect(result).toEqual([10]);
      43 |     result = runTacitTest(vm, '0 if 10 else 20 ;');
    > 44 |     expect(result).toEqual([20]);
         |                    ^
      45 |   });
      46 |   test('bare string shorthand with apostrophe', () => {
      47 |     const result = runTacitTest(vm, "'testWord");

      at Object.<anonymous> (src/test/integration/basic-operations.test.ts:44:20)

 FAIL  src/test/ops/lists/list-spec-compliance.test.ts
  ● Lists.md Specification Compliance › Algebraic laws (Section 20) › pack and unpack are inverses

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 3

      Array [
        1,
        2,
        3,
    +   1,
    +   2,
    +   3,
      ]

      135 |       const original = executeTacitCode(vm, '1 2 3');
      136 |       const restored = executeTacitCode(vm, '1 2 3 3 pack unpack');
    > 137 |       expect(restored).toEqual(original);
          |                        ^
      138 |     });
      139 |   });
      140 | });

      at Object.<anonymous> (src/test/ops/lists/list-spec-compliance.test.ts:137:24)

 FAIL  src/test/ops/lists/structure/head-tail-uncons.test.ts
  ● List structure operations: head/tail › tail on simple list drops first element

    expect(received).toEqual(expected) // deep equality

    - Expected  - 3
    + Received  + 0

      Array [
        3,
        2,
        NaN,
    -   3,
    -   2,
    -   NaN,
      ]

      20 |     const result = executeTacitCode(vm, '( 1 2 3 ) tail');
      21 |     const expected = executeTacitCode(vm, '( 2 3 )');
    > 22 |     expect(result).toEqual(expected);
         |                    ^
      23 |   });
      24 |
      25 |   test('head on nested list returns the nested list value (suffix match)', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/head-tail-uncons.test.ts:22:20)

  ● List structure operations: head/tail › head on nested list returns the nested list value (suffix match)

    expect(received).toEqual(expected) // deep equality

    - Expected  - 3
    + Received  + 0

      Array [
        3,
        2,
        1,
        NaN,
    -   2,
    -   1,
    -   NaN,
      ]

      26 |     const result = executeTacitCode(vm, '( ( 1 2 ) 3 ) head');
      27 |     const expected = executeTacitCode(vm, '( 1 2 )');
    > 28 |     expect(result.slice(-expected.length)).toEqual(expected);
         |                                            ^
      29 |   });
      30 |
      31 |   test('tail on nested list preserves nested structure', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/head-tail-uncons.test.ts:28:44)

  ● List structure operations: head/tail › tail on nested list preserves nested structure

    expect(received).toEqual(expected) // deep equality

    - Expected  - 3
    + Received  + 0

      Array [
        4,
        3,
        NaN,
    -   4,
    -   3,
    -   NaN,
      ]

      32 |     const result = executeTacitCode(vm, '( ( 1 2 ) 3 4 ) tail');
      33 |     const expected = executeTacitCode(vm, '( 3 4 )');
    > 34 |     expect(result).toEqual(expected);
         |                    ^
      35 |   });
      36 |
      37 |   test('tail on empty list returns empty list', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/head-tail-uncons.test.ts:34:20)

  ● List structure operations: head/tail › tail on empty list returns empty list

    expect(received).toEqual(expected) // deep equality

    - Expected  - 1
    + Received  + 0

      Array [
        NaN,
    -   NaN,
      ]

      38 |     const result = executeTacitCode(vm, '( ) tail');
      39 |     const expected = executeTacitCode(vm, '( )');
    > 40 |     expect(result).toEqual(expected);
         |                    ^
      41 |   });
      42 |
      43 |   test('tail on non-list returns empty list', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/head-tail-uncons.test.ts:40:20)

  ● List structure operations: head/tail › tail on non-list returns empty list

    expect(received).toEqual(expected) // deep equality

    - Expected  - 1
    + Received  + 0

      Array [
        NaN,
    -   NaN,
      ]

      44 |     const result = executeTacitCode(vm, '42 tail');
      45 |     const expected = executeTacitCode(vm, '( )');
    > 46 |     expect(result).toEqual(expected);
         |                    ^
      47 |   });
      48 |
      49 |   test('head on non-list returns NIL', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/head-tail-uncons.test.ts:46:20)

 FAIL  src/test/ops/lists/structure/concat-polymorphic.test.ts
  ● Polymorphic concat Operation › Type dispatch verification › simple + simple should create 2-element list

    expect(received).toEqual(expected) // deep equality

    - Expected  - 3
    + Received  + 0

      Array [
        3,
        5,
        NaN,
    -   3,
    -   5,
    -   NaN,
      ]

      17 |       const result = executeTacitCode(vm, '5 3 concat');
      18 |       const expected = executeTacitCode(vm, '( 5 3 )');
    > 19 |       expect(result).toEqual(expected);
         |                      ^
      20 |     });
      21 |
      22 |     test('list + simple should append (O1 efficient)', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-polymorphic.test.ts:19:22)

  ● Polymorphic concat Operation › Type dispatch verification › list + simple should append (O1 efficient)

    expect(received).toEqual(expected) // deep equality

    - Expected  - 4
    + Received  + 0

      Array [
        3,
        2,
        1,
        NaN,
    -   3,
    -   2,
    -   1,
    -   NaN,
      ]

      23 |       const result = executeTacitCode(vm, '( 1 2 ) 3 concat');
      24 |       const expected = executeTacitCode(vm, '( 1 2 3 )');
    > 25 |       expect(result).toEqual(expected);
         |                      ^
      26 |     });
      27 |
      28 |     test('simple + list should prepend', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-polymorphic.test.ts:25:22)

  ● Polymorphic concat Operation › Type dispatch verification › simple + list should prepend

    expect(received).toEqual(expected) // deep equality

    - Expected  - 4
    + Received  + 0

      Array [
        2,
        1,
        5,
        NaN,
    -   2,
    -   1,
    -   5,
    -   NaN,
      ]

      29 |       const result = executeTacitCode(vm, '5 ( 1 2 ) concat');
      30 |       const expected = executeTacitCode(vm, '( 5 1 2 )');
    > 31 |       expect(result).toEqual(expected);
         |                      ^
      32 |     });
      33 |
      34 |     test('list + list should concatenate', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-polymorphic.test.ts:31:22)

  ● Polymorphic concat Operation › Type dispatch verification › list + list should concatenate

    expect(received).toEqual(expected) // deep equality

    - Expected  - 5
    + Received  + 0

    @@ -2,11 +2,6 @@
        4,
        3,
        2,
        1,
        NaN,
    -   4,
    -   3,
    -   2,
    -   1,
    -   NaN,
      ]

      35 |       const result = executeTacitCode(vm, '( 1 2 ) ( 3 4 ) concat');
      36 |       const expected = executeTacitCode(vm, '( 1 2 3 4 )');
    > 37 |       expect(result).toEqual(expected);
         |                      ^
      38 |     });
      39 |   });
      40 |

      at Object.<anonymous> (src/test/ops/lists/structure/concat-polymorphic.test.ts:37:22)

  ● Polymorphic concat Operation › Edge cases › empty list + simple should work

    expect(received).toEqual(expected) // deep equality

    - Expected  - 2
    + Received  + 0

      Array [
        5,
        NaN,
    -   5,
    -   NaN,
      ]

      43 |       const result = executeTacitCode(vm, '( ) 5 concat');
      44 |       const expected = executeTacitCode(vm, '( 5 )');
    > 45 |       expect(result).toEqual(expected);
         |                      ^
      46 |     });
      47 |
      48 |     test('simple + empty list should work', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-polymorphic.test.ts:45:22)

  ● Polymorphic concat Operation › Edge cases › simple + empty list should work

    expect(received).toEqual(expected) // deep equality

    - Expected  - 2
    + Received  + 0

      Array [
        5,
        NaN,
    -   5,
    -   NaN,
      ]

      49 |       const result = executeTacitCode(vm, '5 ( ) concat');
      50 |       const expected = executeTacitCode(vm, '( 5 )');
    > 51 |       expect(result).toEqual(expected);
         |                      ^
      52 |     });
      53 |
      54 |     test('empty + empty should work', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-polymorphic.test.ts:51:22)

  ● Polymorphic concat Operation › Edge cases › empty + empty should work

    expect(received).toEqual(expected) // deep equality

    - Expected  - 1
    + Received  + 0

      Array [
        NaN,
    -   NaN,
      ]

      55 |       const result = executeTacitCode(vm, '( ) ( ) concat');
      56 |       const expected = executeTacitCode(vm, '( )');
    > 57 |       expect(result).toEqual(expected);
         |                      ^
      58 |     });
      59 |   });
      60 |

      at Object.<anonymous> (src/test/ops/lists/structure/concat-polymorphic.test.ts:57:22)

  ● Polymorphic concat Operation › Comparison with existing operations › simple+simple should match manual list creation

    expect(received).toEqual(expected) // deep equality

    - Expected  - 3
    + Received  + 0

      Array [
        8,
        7,
        NaN,
    -   8,
    -   7,
    -   NaN,
      ]

      63 |       const ccatResult = executeTacitCode(vm, '7 8 concat');
      64 |       const manualResult = executeTacitCode(vm, '( 7 8 )');
    > 65 |       expect(ccatResult).toEqual(manualResult);
         |                          ^
      66 |     });
      67 |
      68 |     test('list+simple should be equivalent to existing append-like behavior', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-polymorphic.test.ts:65:26)

  ● Polymorphic concat Operation › Comparison with existing operations › list+simple should be equivalent to existing append-like behavior

    expect(received).toEqual(expected) // deep equality

    - Expected  - 4
    + Received  + 0

      Array [
        30,
        20,
        10,
        NaN,
    -   30,
    -   20,
    -   10,
    -   NaN,
      ]

      70 |       const ccatResult = executeTacitCode(vm, '( 10 20 ) 30 concat');
      71 |       const expectedResult = executeTacitCode(vm, '( 10 20 30 )');
    > 72 |       expect(ccatResult).toEqual(expectedResult);
         |                          ^
      73 |     });
      74 |
      75 |     test('simple+list should match prepend behavior', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-polymorphic.test.ts:72:26)

  ● Polymorphic concat Operation › Comparison with existing operations › simple+list should match prepend behavior

    expect(received).toEqual(expected) // deep equality

    - Expected  - 5
    + Received  + 0

    @@ -2,11 +2,6 @@
        3,
        2,
        1,
        99,
        NaN,
    -   3,
    -   2,
    -   1,
    -   99,
    -   NaN,
      ]

      76 |       const ccatResult = executeTacitCode(vm, '99 ( 1 2 3 ) concat');
      77 |       const expected = executeTacitCode(vm, '( 99 1 2 3 )');
    > 78 |       expect(ccatResult).toEqual(expected);
         |                          ^
      79 |     });
      80 |   });
      81 | });

      at Object.<anonymous> (src/test/ops/lists/structure/concat-polymorphic.test.ts:78:26)

 FAIL  src/test/ops/local-vars/compound-var.test.ts
  ● Compound Variables - Empty Lists › should store empty list in local variable and return reference

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 2
    Received array:  [NaN, NaN]

      40 |     `,
      41 |     );
    > 42 |     expect(materializedResult).toHaveLength(1);
         |                                ^
      43 |     // Both should work with length operation but reference doesn't need resolve
      44 |     const refLength = executeTacitCode(
      45 |       vm,

      at Object.<anonymous> (src/test/ops/local-vars/compound-var.test.ts:42:32)

  ● Compound Variables - Empty Lists › should match direct empty list length

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 1

      Array [
        0,
    +   0,
      ]

      83 |     );
      84 |
    > 85 |     expect(varLength).toEqual(directLength);
         |                       ^
      86 |     expect(varLength).toEqual([0]);
      87 |   });
      88 |

      at Object.<anonymous> (src/test/ops/local-vars/compound-var.test.ts:85:23)

  ● Compound Variables - Empty Lists › should materialize actual list with load

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 2
    Received array:  [NaN, NaN]

      101 |     );
      102 |
    > 103 |     expect(resolveEmpty).toHaveLength(1);
          |                          ^
      104 |     expect(directEmpty).toHaveLength(1);
      105 |     // Test that both behave the same with length operation
      106 |     const directLength = executeTacitCode(vm, '() length');

      at Object.<anonymous> (src/test/ops/local-vars/compound-var.test.ts:103:26)

  ● Compound Variables - Single Element Lists › should store single-element list in local variable and return value

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 3
    Received array:  [1, NaN, NaN]

      154 |     `,
      155 |     );
    > 156 |     expect(refResult).toHaveLength(1); // Should be DATA_REF resolving to return stack
          |                       ^
      157 |   });
      158 |
      159 |   test('should work with length operation on single-element list', () => {

      at Object.<anonymous> (src/test/ops/local-vars/compound-var.test.ts:156:23)

  ● Compound Variables - Single Element Lists › should match direct single-element list length

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 1

      Array [
        1,
    +   1,
      ]

      185 |     );
      186 |
    > 187 |     expect(varLength).toEqual(directLength);
          |                       ^
      188 |     expect(varLength).toEqual([1]);
      189 |   });
      190 |

      at Object.<anonymous> (src/test/ops/local-vars/compound-var.test.ts:187:23)

 FAIL  src/test/lang/immediate-words.test.ts
  ● Immediate words › if immediate compiles single-branch conditionals

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 1

      Array [
    +   5,
        4,
      ]

      56 |
      57 |     const negateFalse = executeTacitCode(vm, ': maybe-negate dup 0 lt if neg ; ; 4 maybe-negate');
    > 58 |     expect(negateFalse).toEqual([4]);
         |                         ^
      59 |   });
      60 |
      61 |   test('if/else immediate compiles dual-branch conditionals', () => {

      at Object.<anonymous> (src/test/lang/immediate-words.test.ts:58:25)

  ● Immediate words › if/else immediate compiles dual-branch conditionals

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 1

      Array [
    +   1,
        -1,
      ]

      65 |
      66 |     const negative = executeTacitCode(vm, '-7 0 lt if -1 else 1 ;');
    > 67 |     expect(negative).toEqual([-1]);
         |                      ^
      68 |   });
      69 |
      70 |   test('else without if raises syntax error', () => {

      at Object.<anonymous> (src/test/lang/immediate-words.test.ts:67:22)

 FAIL  src/test/ops/lists/structure/concat-basic.test.ts
  ● Concat operation scenarios › simple + simple -> ( 1 2 )

    expect(received).toEqual(expected) // deep equality

    - Expected  - 3
    + Received  + 0

      Array [
        2,
        1,
        NaN,
    -   2,
    -   1,
    -   NaN,
      ]

      13 |     const result = executeTacitCode(vm, '1 2 concat');
      14 |     const expected = executeTacitCode(vm, '( 1 2 )');
    > 15 |     expect(result).toEqual(expected);
         |                    ^
      16 |   });
      17 |
      18 |   test('simple + list (prepend) -> ( 1 2 3 )', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-basic.test.ts:15:20)

  ● Concat operation scenarios › simple + list (prepend) -> ( 1 2 3 )

    expect(received).toEqual(expected) // deep equality

    - Expected  - 4
    + Received  + 0

      Array [
        3,
        2,
        1,
        NaN,
    -   3,
    -   2,
    -   1,
    -   NaN,
      ]

      19 |     const result = executeTacitCode(vm, '1 ( 2 3 ) concat');
      20 |     const expected = executeTacitCode(vm, '( 1 2 3 )');
    > 21 |     expect(result).toEqual(expected);
         |                    ^
      22 |   });
      23 |
      24 |   test('list + simple (append) -> ( 1 2 3 )', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-basic.test.ts:21:20)

  ● Concat operation scenarios › list + simple (append) -> ( 1 2 3 )

    expect(received).toEqual(expected) // deep equality

    - Expected  - 4
    + Received  + 0

      Array [
        3,
        2,
        1,
        NaN,
    -   3,
    -   2,
    -   1,
    -   NaN,
      ]

      25 |     const result = executeTacitCode(vm, '( 1 2 ) 3 concat');
      26 |     const expected = executeTacitCode(vm, '( 1 2 3 )');
    > 27 |     expect(result).toEqual(expected);
         |                    ^
      28 |   });
      29 |
      30 |   test('list + list (flat) -> ( 1 2 3 4 )', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-basic.test.ts:27:20)

  ● Concat operation scenarios › list + list (flat) -> ( 1 2 3 4 )

    expect(received).toEqual(expected) // deep equality

    - Expected  - 5
    + Received  + 0

    @@ -2,11 +2,6 @@
        4,
        3,
        2,
        1,
        NaN,
    -   4,
    -   3,
    -   2,
    -   1,
    -   NaN,
      ]

      31 |     const result = executeTacitCode(vm, '( 1 2 ) ( 3 4 ) concat');
      32 |     const expected = executeTacitCode(vm, '( 1 2 3 4 )');
    > 33 |     expect(result).toEqual(expected);
         |                    ^
      34 |   });
      35 |
      36 |   test('empty + list -> list', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-basic.test.ts:33:20)

  ● Concat operation scenarios › empty + list -> list

    expect(received).toEqual(expected) // deep equality

    - Expected  - 3
    + Received  + 0

      Array [
        8,
        7,
        NaN,
    -   8,
    -   7,
    -   NaN,
      ]

      37 |     const result = executeTacitCode(vm, '( ) ( 7 8 ) concat');
      38 |     const expected = executeTacitCode(vm, '( 7 8 )');
    > 39 |     expect(result).toEqual(expected);
         |                    ^
      40 |   });
      41 |
      42 |   test('list + empty -> list', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-basic.test.ts:39:20)

  ● Concat operation scenarios › list + empty -> list

    expect(received).toEqual(expected) // deep equality

    - Expected  - 3
    + Received  + 0

      Array [
        8,
        7,
        NaN,
    -   8,
    -   7,
    -   NaN,
      ]

      43 |     const result = executeTacitCode(vm, '( 7 8 ) ( ) concat');
      44 |     const expected = executeTacitCode(vm, '( 7 8 )');
    > 45 |     expect(result).toEqual(expected);
         |                    ^
      46 |   });
      47 |
      48 |   test('empty + empty -> empty', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-basic.test.ts:45:20)

  ● Concat operation scenarios › empty + empty -> empty

    expect(received).toEqual(expected) // deep equality

    - Expected  - 1
    + Received  + 0

      Array [
        NaN,
    -   NaN,
      ]

      49 |     const result = executeTacitCode(vm, '( ) ( ) concat');
      50 |     const expected = executeTacitCode(vm, '( )');
    > 51 |     expect(result).toEqual(expected);
         |                    ^
      52 |   });
      53 |
      54 |   test('nested elements preserved as units', () => {

      at Object.<anonymous> (src/test/ops/lists/structure/concat-basic.test.ts:51:20)

  ● Concat operation scenarios › nested elements preserved as units

    expect(received).toEqual(expected) // deep equality

    - Expected  - 8
    + Received  + 0

    @@ -5,14 +5,6 @@
        3,
        2,
        1,
        NaN,
        NaN,
    -   5,
    -   NaN,
    -   4,
    -   3,
    -   2,
    -   1,
    -   NaN,
    -   NaN,
      ]

      55 |     const result = executeTacitCode(vm, '( ( 1 2 ) 3 ) ( 4 ( 5 ) ) concat');
      56 |     const expected = executeTacitCode(vm, '( ( 1 2 ) 3 4 ( 5 ) )');
    > 57 |     expect(result).toEqual(expected);
         |                    ^
      58 |   });
      59 | });
      60 |

      at Object.<anonymous> (src/test/ops/lists/structure/concat-basic.test.ts:57:20)

 FAIL  src/test/ops/lists/build/pack-unpack.test.ts
  ● List build operations: pack/unpack/enlist › enlist converts value to single-element list

    expect(received).toEqual(expected) // deep equality

    - Expected  - 2
    + Received  + 0

      Array [
        42,
        NaN,
    -   42,
    -   NaN,
      ]

      24 |     const stack = executeTacitCode(vm, '42 enlist');
      25 |     const expected = executeTacitCode(vm, '( 42 )');
    > 26 |     expect(stack).toEqual(expected);
         |                   ^
      27 |   });
      28 |
      29 |   test('pack with zero count yields empty list', () => {

      at Object.<anonymous> (src/test/ops/lists/build/pack-unpack.test.ts:26:19)

  ● List build operations: pack/unpack/enlist › pack with zero count yields empty list

    expect(received).toEqual(expected) // deep equality

    - Expected  - 1
    + Received  + 0

      Array [
        NaN,
    -   NaN,
      ]

      30 |     const stack = executeTacitCode(vm, '0 pack');
      31 |     const expected = executeTacitCode(vm, '( )');
    > 32 |     expect(stack).toEqual(expected);
         |                   ^
      33 |   });
      34 | });
      35 |

      at Object.<anonymous> (src/test/ops/lists/build/pack-unpack.test.ts:32:19)

 FAIL  src/test/ops/broadcast/negate-broadcast.test.ts
  ● Unary broadcasting: neg › nested list (pretty-printed assertions)

    expect(received).toEqual(expected) // deep equality

    - Expected  -  0
    + Received  + 15

      Array [
    +   3,
    +   2,
    +   1,
    +   NaN,
    +   NaN,
    +   -3,
    +   -2,
    +   -1,
    +   NaN,
    +   NaN,
    +   -3,
    +   -2,
    +   -1,
    +   NaN,
    +   NaN,
        2,
      ]

      39 |     // Element count preserved
      40 |     const lengths = runTacitTest(vm, '( ( 1 2 ) 3 ) neg size');
    > 41 |     expect(lengths).toEqual([2]);
         |                     ^
      42 |   });
      43 |
      44 |   test('empty list', () => {

      at Object.<anonymous> (src/test/ops/broadcast/negate-broadcast.test.ts:41:21)

 FAIL  src/test/ops/lists/build/open-close-parser-integration.test.ts
  ● List parser integration: open/close › nested lists parse correctly

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 6

    @@ -3,6 +3,12 @@
        3,
        2,
        NaN,
        1,
        NaN,
    +   4,
    +   3,
    +   2,
    +   NaN,
    +   1,
    +   NaN,
      ]

      22 |     // Roundtrip property: reversing twice preserves
      23 |     const doubleReverse = executeTacitCode(vm, '( 1 ( 2 3 ) 4 ) reverse reverse');
    > 24 |     expect(doubleReverse).toEqual(stack);
         |                           ^
      25 |   });
      26 | });
      27 |

      at Object.<anonymous> (src/test/ops/lists/build/open-close-parser-integration.test.ts:24:27)


Test Suites: 16 failed, 2 skipped, 129 passed, 145 of 147 total
Tests:       50 failed, 2 skipped, 1287 passed, 1339 total
Snapshots:   0 total
Time:        32.916 s, estimated 39 s
Ran all test suites matching /\/Users\/johnhardy\/Documents\/projects\/ts-tacitus\/src\/test/i.
error Command failed with exit code 1.
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.
